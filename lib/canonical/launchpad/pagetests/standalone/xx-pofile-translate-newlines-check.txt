XXX: CarlosPerelloMarin 20060609: To validate textarea data content, we are
using 'print browser.contents' because the testing infrastructure is adding
extra new line characters with text areas when you get the value with
getControl(...).value. For more information, please, read bug #47511.

First, we check that the textarea is empty by default.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open(
  ...     'http://localhost/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?start=19&batch=1')
  >>> browser.url
  'http://localhost/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?start=19&batch=1'
  >>> print browser.contents
  <!DOCTYPE html PUBLIC...
  ...<textarea style="width: 100%;" tabindex="1"
               lang="es" rows="5"
               name="msgset_149_es_translation_0"
               dir="ltr"></textarea>...

Now, we submit some text with new lines before and after the text, the
answer should have exactly those strings.

  >>> browser.getControl(name='msgset_149_es_translation_0').value = '\r\nfoo\r\n\r\n'
  >>> browser.getControl(name='submit_translations').click()
  >>> browser.url
  'http://localhost/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate'
  >>> print browser.contents
  <!DOCTYPE html PUBLIC...
  ...<textarea style="width: 100%;" tabindex="1"
               lang="es" rows="5"
               name="msgset_149_es_translation_0"
               dir="ltr">
  <BLANKLINE>
  foo
  <BLANKLINE>
  </textarea>
  ...

And finally, a line that does not start with a new line so we are sure we
don't get extra whitespaces. The NORMALIZE_WHITESPACE must be there, if you
change the test, to be 100% sure that the textarea content is the right one.

  >>> browser.getControl(name='msgset_149_es_translation_0').value = 'foo'
  >>> browser.getControl(name='submit_translations').click()
  >>> browser.url
  'http://localhost/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate'
  >>> print browser.contents #doctest: -NORMALIZE_WHITESPACE
  <!DOCTYPE html PUBLIC...
              <textarea style="width: 100%;" tabindex="1"
                        lang="es" rows="5"
                        name="msgset_149_es_translation_0"
                        dir="ltr">
  foo</textarea>
  ...

Now, Check that even though the user forgot the trailing new line char, Rosetta
adds it automatically

  >>> browser.open('http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=21&batch=1')
  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=21&batch=1'
  >>> browser.getControl(name='msgset_165_es_translation_0').value = '%s: la opcion \xc2\xab%s\xc2\xbb es ambigua'
  >>> browser.getControl(name='submit_translations').click()

We were redirected to the next form, the translation was accepted.

  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=0&batch=1'

Get previous page to check that the save translation is the right one.

  >>> browser.getLink('Last').click()
  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=21&batch=1'

And, as we can see, we get the trailing new line char

  >>> print browser.contents
  <!DOCTYPE html PUBLIC...
  ...<textarea style="width: 100%;" tabindex="1"
               lang="es" rows="2"
               name="msgset_165_es_translation_0"
               dir="ltr">
  %s: la opcion «%s» es ambigua
  </textarea>
  ...

Now, we do the right submit, with one trailing new line...

  >>> browser.getControl(name='msgset_165_es_translation_0').value = '%s: la opcion \xc2\xab%s\xc2\xbb es ambigua\r\n'
  >>> browser.getControl(name='submit_translations').click()

We were redirected to the next form, the translation was accepted.

  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=0&batch=1'

Get previous page to check that the save translation is the right one.

  >>> browser.getLink('Last').click()
  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=21&batch=1'

And, as we can see, we get the same output, just one trailing new line char

  >>> print browser.contents
  <!DOCTYPE html PUBLIC...
  ...<textarea style="width: 100%;" tabindex="1"
               lang="es" rows="2"
               name="msgset_165_es_translation_0"
               dir="ltr">
  %s: la opcion «%s» es ambigua
  </textarea>
  ...

Last check, the user sends two new line chars instead of just one...

  >>> browser.getControl(name='msgset_165_es_translation_0').value = '%s: la opcion \xc2\xab%s\xc2\xbb es ambigua\r\n\r\n'
  >>> browser.getControl(name='submit_translations').click()

We were redirected to the next form, the translation was accepted.

  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=0&batch=1'

Get previous page to check that the save translation is the right one.

  >>> browser.getLink('Last').click()
  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=21&batch=1'

And Rosetta comes to the rescue and stores just one!.

  >>> print browser.contents
  <!DOCTYPE html PUBLIC...
  ...<textarea style="width: 100%;" tabindex="1"
               lang="es" rows="2"
               name="msgset_165_es_translation_0"
               dir="ltr">
  %s: la opcion «%s» es ambigua
  </textarea>
  ...
