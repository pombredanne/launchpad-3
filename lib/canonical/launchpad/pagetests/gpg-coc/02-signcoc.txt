  First we check that Sample Person never signed a code of conduct.

  >>> browser.addHeader("Authorization", "Basic test@canonical.com:test")
  >>> browser.open("http://launchpad.dev/~name12/+codesofconduct")

  >>> "Sample Person has never signed" in browser.contents
  True


  First we define a helper function

  >>> import canonical.launchpad
  >>> import os.path
  >>> def filename_path(filename):
  ...   return os.path.join(
  ...   os.path.dirname(canonical.launchpad.__file__),
  ...   'pagetests/gpg-coc/%s' % filename)
  ...

  Then we try to register a code of conduct with a truncated CoC:

  >>> filename = filename_path("truncated_coc.asc")
  >>> truncated_coc = open(filename).read()

  >>> browser.open("http://launchpad.dev/codeofconduct/1.0.1/+sign")
  >>> browser.getControl("Signed Code").value = truncated_coc
  >>> browser.getControl("Continue").click()

  >>> message = (
  ... "The signed text does not match the Code of Conduct. Make sure that "
  ... "you signed the correct text (white space differences are acceptable")
  >>> message in browser.contents
  True

  We try to register an old version of the code (version 1.0)

  >>> filename = filename_path("10_coc.asc")
  >>> old_coc = open(filename).read()
  >>> browser.getControl("Signed Code").value = old_coc
  >>> browser.getControl("Continue").click()

  >>> message in browser.contents
  True

  If we try to access the old version page to sign it
  >>> browser.open("http://launchpad.dev/codeofconduct/1.0/+sign")

  We're presented with a link to the current code page
  >>> current_coc_link = browser.getLink("the current version")
  >>> current_coc_link.url
  'http://launchpad.dev/codeofconduct/1.0.1'

  We navigate to the current Code page
  >>> current_coc_link.click()
  >>> browser.getLink("Sign this version").click()
  >>> browser.url
  'http://launchpad.dev/codeofconduct/1.0.1/+sign'


  Now we try to register the code of conduct, using an reformatted copy
  (leading spaces removed).

  >>> filename = filename_path("reformatted_101_coc.asc")
  >>> reformatted_coc = open(filename).read()
  >>> browser.getControl("Signed Code").value = reformatted_coc
  >>> browser.getControl("Continue").click()

  This succeeds because the words are the same and in the same order.

  >>> browser.url
  'http://launchpad.dev/~name12/+codesofconduct'

  >>> browser.open("http://launchpad.dev/~name12/+codesofconduct")
  >>> "1024D/DFD20543" in browser.contents
  True
