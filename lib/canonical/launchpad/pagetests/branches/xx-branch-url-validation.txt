= Validating of branch URLs =

First, let's define a helper template to post to the Person +addbranch form.

>>> post_person_addbranch = r"""
... POST /people/lifeless/+addbranch HTTP/1.1
... Host: launchpad.dev
... Authorization: Basic Zm9vLmJhckBjYW5vbmljYWwuY29tOnRlc3Q=
... Content-Length: 1315
... Content-Type: multipart/form-data; boundary=---------------------------16855892469756896411380849908
... Cookie: launchpad=XEJ1RoB92REqSdZahy5y.gVGBDo01dWhgSd.HER7DezKTr2eoFzkoU
... Referer: http://launchpad.dev/people/lifeless/+addbranch
... 
... -----------------------------16855892469756896411380849908
... Content-Disposition: form-data; name="field.product"
... 
... 
... -----------------------------16855892469756896411380849908
... Content-Disposition: form-data; name="field.name"
... 
... pyresources
... -----------------------------16855892469756896411380849908
... Content-Disposition: form-data; name="field.title"
... 
... Resource Management for Unit Tests
... -----------------------------16855892469756896411380849908
... Content-Disposition: form-data; name="field.url"
... 
... %s
... -----------------------------16855892469756896411380849908
... Content-Disposition: form-data; name="field.home_page"
... 
... 
... -----------------------------16855892469756896411380849908
... Content-Disposition: form-data; name="field.lifecycle_status"
... 
... New
... -----------------------------16855892469756896411380849908
... Content-Disposition: form-data; name="field.lifecycle_status-empty-marker"
... 
... 1
... -----------------------------16855892469756896411380849908
... Content-Disposition: form-data; name="field.summary"
... 
... A resource management framework for handling unit test fixtures in Python.
... -----------------------------16855892469756896411380849908
... Content-Disposition: form-data; name="field.actions.add"
... 
... Add Branch
... -----------------------------16855892469756896411380849908--
... """

Try to create a branch with an invalid URL.

>>> print http(post_person_addbranch % (
...     'example.com/~lifeless/pyresources/',))
HTTP/1.1 200 Ok
...Not a valid URL. Please enter the full URL...


Try to create branches with URLs in bazaar.launchpad.net.

>>> print http(post_person_addbranch % (
...     'http://bazaar.launchpad.net',))
HTTP/1.1 200 Ok
...Don't manually register a bzr branch on <code>bazaar.launchpad.net</code>...

>>> print http(post_person_addbranch % (
...     'http://bazaar.launchpad.net/~me/that/this',))
HTTP/1.1 200 Ok
...Don't manually register a bzr branch on <code>bazaar.launchpad.net</code>...


Try to create a branch with a URL that is already registered.

>>> print http(post_person_addbranch % (
...     'http://example.com/gnome-terminal/main/',))
HTTP/1.1 200 Ok
...GNOME Terminal Mainline</a> is already registered with this URL...


Try to create a branch without URL

>>> print http(post_person_addbranch % '')
HTTP/1.1 200 Ok
...Required input is missing...


== The other forms ==

The +addbranch form of Product, and the +edit form of a branch all use the same validation logic that the previous form, since it is defined in the IBranch interface. No point in repeating the tests here.
