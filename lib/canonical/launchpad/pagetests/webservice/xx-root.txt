= Introduction =

The service root (/[version]/) is a resource that responds to GET by
describing the web service. The description is a JSON map full of
links to the top-level web service objects.

  >>> top_level_response = webservice.get("/beta/")
  >>> top_level_links = top_level_response.jsonBody()
  >>> sorted(top_level_links.keys())
  [u'bugs_collection_link', u'me_link', u'people_collection_link',
   u'projects_collection_link']
  >>> top_level_links['bugs_collection_link']
  u'http://api.launchpad.dev/beta/bugs'
  >>> top_level_links['me_link']
  u'http://api.launchpad.dev/beta/people/+me'

The client can explore the entire web service by following these links
to other resources, and following the links served in those resources'
JSON representations, and so on. If the client doesn't know the
capabilities of a certain resource it can request a WADL
representation of that resource (see the xx-wadl.txt test) and find
out.

Though web services in general support all HTTP methods, this
particular resource supports only GET. Eventually it will also support
HEAD and OPTIONS.

  >>> for method in ['HEAD', 'POST', 'PUT', 'DELETE', 'OPTIONS']:
  ...     print webservice("/beta/", method)
  HTTP/1.1 405 Method Not Allowed
  Allow: GET
  ...
  HTTP/1.1 405 Method Not Allowed
  Allow: GET
  ...
  HTTP/1.1 405 Method Not Allowed
  Allow: GET
  ...
  HTTP/1.1 405 Method Not Allowed
  Allow: GET
  ...
  HTTP/1.1 405 Method Not Allowed
  Allow: GET
  ...

== Conditional GET ==

The service root never changes except when Launchpad is upgraded. To
avoid getting it more often than that, a client can store the value of
the 'ETag' response header the first time it retrieves the service
root.

  >>> etag = top_level_response.getHeader('ETag')
  >>> etag is None
  False

The value of 'ETag' can be used in a subsequent request as the
'If-None-Match' request header. If the client's old ETag matches the
current ETag, the representation won't be served again.

  >>> conditional_response = webservice.get(
  ...     '/beta/', headers={'If-None-Match' : etag})
  >>> conditional_response.getStatus()
  304
  >>> conditional_response.getBody()
  ''

  >>> conditional_response = webservice.get(
  ...     '/beta/', headers={'If-None-Match' : '"a-very-old-etag"'})
  >>> conditional_response.getStatus()
  200
  >>> conditional_response.jsonBody()
  {...}

You can specify a number of etags in If-None-Match. You'll get a new
representation only if *none* of them match:

  >>> conditional_response = webservice.get(
  ...     '/beta/',
  ...     headers={'If-None-Match' : '"a-very-old-etag", %s' %  etag})
  >>> conditional_response.getStatus()
  304

  >>> conditional_response = webservice.get(
  ...     '/beta/',
  ...     headers={'If-None-Match' : '"a-very-old-etag", "another-etag"'})
  >>> conditional_response.getStatus()
  200


== Compression ==

You can get a compressed representation by setting the TE request
header to "gzip" or "deflate". The "Transfer-Encoding" response
header will show the compression algorithm used.

  >>> from cStringIO import StringIO
  >>> from gzip import GzipFile
  >>> gzipped_response = webservice.get(
  ...     '/beta/', headers={'TE' : 'gzip'})
  >>> gzipped_response.getHeader("Transfer-Encoding")
  'gzip'
  >>> GzipFile(fileobj=StringIO(gzipped_response.getBody())).read()
  '{...}'

  >>> import zlib
  >>> deflated_response = webservice.get(
  ...     '/beta/', headers={'TE' : 'deflate'})
  >>> deflated_response.getHeader("Transfer-Encoding")
  'deflate'
  >>> zlib.decompress(deflated_response.getBody())
  '{...}'

The syntax for TE is the same as for the Accept header.

  >>> response = webservice.get(
  ...     '/beta/', headers={'TE' : 'deflate, gzip'})
  >>> response.getHeader("Transfer-Encoding")
  'compress'

  >>> response = webservice.get(
  ...     '/beta/',
  ...     headers={'TE' : 'deflate;q=0.8, unsupported;q=1.0, gzip;q=0.9'})
  >>> response.getHeader("Transfer-Encoding")
  'gzip'
