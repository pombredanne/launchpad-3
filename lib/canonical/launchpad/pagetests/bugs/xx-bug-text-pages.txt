= Bug Text Pages =

Launchpad provides a way for users to view textual descriptions of bug reports,
as an alternative to the graphical user interface.

To demonstrate this feature, we'll use bug 1.

We'll start by adding some attachments to the bug:

    >>> import StringIO
    >>> from canonical.database.sqlbase import flush_database_updates
    >>> from canonical.launchpad.ftests.ppa import publishToPPA
    >>> from canonical.launchpad.ftests import ANONYMOUS, login, logout
    >>> from canonical.launchpad.database import Bug, Person
    >>> login("foo.bar@canonical.com")
    >>> mark = Person.selectOneBy(name="sabdfl")
    >>> mark.displayname = u"M\xe1rk Sh\xfattlew\xf2rth"
    >>> bug = Bug.get(1)
    >>> content = StringIO.StringIO("<html><body>bogus</body></html>")
    >>> a1 = bug.addAttachment(mark, content, "comment for file a", "file_a.txt",
    ...     content_type="text/html")
    >>> content = StringIO.StringIO("do we need to")
    >>> a2 = bug.addAttachment(mark, content, "comment for file with space",
    ...     "file with space.txt", content_type="text/plain")

Next, we'll cycle through all statuses so the dates are present:

    >>> from canonical.launchpad.interfaces import BugTaskStatus
    >>> t0 = bug.bugtasks[0]
    >>> t0.transitionToStatus(BugTaskStatus.INCOMPLETE, mark)
    >>> t0.transitionToStatus(BugTaskStatus.CONFIRMED, mark)
    >>> t0.transitionToStatus(BugTaskStatus.INPROGRESS, mark)
    >>> t0.transitionToStatus(BugTaskStatus.FIXRELEASED, mark)
    >>> logout()
    >>> flush_database_updates()


== Text Pages from a Bug Context ==

Users can view a textual description of any bug at that bug's text page,
according to the following URL pattern:

    http://launchpad.dev/bugs/<bug-number>/+text

For example, users can view a textual description of bug 1:

    >>> anon_browser.open('http://launchpad.dev/bugs/1/+text')
    >>> anon_browser.url
    'http://launchpad.dev/bugs/1/+text'
    >>> print anon_browser.headers['content-type']
    text/plain;charset=utf-8 

The textual description contains basic information about that bug, along with
all tasks related to that bug, presented in an easy-to-digest format:

    >>> text_bug = anon_browser.contents
    >>> print text_bug
    bug: 1
    title: Firefox does not support SVG
    date-reported: Thu, 01 Jan 2004 20:58:04 -0000
    date-updated: ...
    reporter: Sample Person (name12)
    duplicate-of: 
    duplicates: 
    attachments:
        http://.../file_a.txt text/html
        http://.../file%20with%20space.txt text/plain
    tags: 
    subscribers: 
        Steve Alexander (stevea)
        Sample Person (name12)
    <BLANKLINE>
    task: firefox
    status: Fix Released
    date-created: Fri, 02 Jan 2004 03:49:22 -0000
    date-confirmed: ...
    date-assigned: 2005-01-02 11:07:20.330975+00:00
    date-inprogress: ...
    date-closed: ...
    reporter: Sample Person (name12)
    importance: Low
    assignee: M...rk Sh...ttlew...rth (sabdfl)
    milestone: 
    <BLANKLINE>
    task: mozilla-firefox (Ubuntu)
    status: New
    date-created: Sat, 17 Jan 2004 01:15:48 -0000
    date-assigned: 2005-01-17 01:15:48.241836+00:00
    reporter: Foo Bar (name16)
    importance: Medium
    component: main
    assignee: 
    milestone: 
    <BLANKLINE>
    task: mozilla-firefox (Debian)
    status: Confirmed
    date-created: Sun, 04 Jan 2004 03:49:22 -0000
    date-assigned: 2005-01-04 11:07:20.584746+00:00
    reporter: Sample Person (name12)
    watch: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=304014
    importance: Low
    assignee: 
    milestone: 
    <BLANKLINE>
    Content-Type: multipart/mixed; boundary="...
    MIME-Version: 1.0
    <BLANKLINE>
    --...
    Content-Type: text/plain; charset="utf-8"
    Content-Transfer-Encoding: quoted-printable
    <BLANKLINE>
    Firefox needs to support embedded SVG images, now that the standard has
    been finalised.
    <BLANKLINE>
    The SVG standard 1.0 is complete, and draft implementations for Firefox
    exist. One of these implementations needs to be integrated with the base
    install of Firefox. Ideally, the implementation needs to include support
    for the manipulation of SVG objects from JavaScript to enable interactive
    and dynamic SVG drawings.
    --...
    ...
    --...
    Content-Type: text/plain; charset="utf-8"
    Content-Transfer-Encoding: quoted-printable
    Author: ... (sabdfl)
    Date: ...
    Message-Id: ...
    <BLANKLINE>
    comment for file with space
    --...


== Text Pages from a Bug Task Context ==

Users can also view a textual description of a bug from the context of a task
relating to that bug, according to the following URL pattern:

   http://launchpad.dev/<target>/+bug/<number>/+text

For example, since bug 1 affects Mozilla Firefox, users can view the textual
description of bug 1 directly from the Mozilla Firefox-specific text page:

    >>> anon_browser.open('http://launchpad.dev/firefox/+bug/1/+text')
    >>> anon_browser.url
    'http://launchpad.dev/firefox/+bug/1/+text'

    >>> print anon_browser.headers['content-type']
    text/plain;charset=utf-8

The textual report contains the same information as the report provided by the
parent bug context:

    >>> text_bug_task = anon_browser.contents
    >>> print text_bug_task
    bug: 1
    title: Firefox does not support SVG
    ...

Although the bug task's textual report contains identical information to the
parent bug's textual report, it's not possible to show this by comparing the
response strings to one another directly. This is because each report contains
multiple sections separated by a pseudo-random string that changes from one
request to another.

However, we can show that the reports are identical by comparing the sections
that comprise them. First, we use a regular expression to extract the pseudo-
random separator string for each report:

    >>> import re
    >>> separator_regex = re.compile(
    ...     'Content-Type: multipart/mixed; boundary\\="([^"]+)"')

    >>> separator_bug = separator_regex.findall(text_bug)[0]
    >>> separator_bug_task = separator_regex.findall(text_bug_task)[0]

Now we can show that the individual sections are identical for each report:

    >>> text_bug.split(separator_bug) == text_bug_task.split(separator_bug_task)
    True


== Duplicate Bugs ==

When one bug duplicates another bug, the textual description includes the
duplicated bug's ID:

    >>> anon_browser.open('http://launchpad.dev/bugs/6/+text')
    >>> anon_browser.url
    'http://launchpad.dev/bugs/6/+text'
    >>> print anon_browser.headers['content-type']
    text/plain;charset=utf-8 

    >>> print anon_browser.contents
    bug: 6
    ...
    duplicate-of: 5
    ...

When a bug has duplicate bugs, the textual description includes a list of the
duplicate bug IDs:

    >>> anon_browser.open('http://launchpad.dev/bugs/5/+text')
    >>> anon_browser.url
    'http://launchpad.dev/bugs/5/+text'
    >>> print anon_browser.headers['content-type']
    text/plain;charset=utf-8 

    >>> print anon_browser.contents
    bug: 5
    ...
    duplicate-of: 
    duplicates: 6
    ...


== Bug Lists ==

Users can also see a list of all bug IDs for a given target by viewing that
product's bugs text page, according to the following URL pattern:

   http://launchpad.dev/<target>/+bugs-text

For example, users can see the list of bug IDs for Mozilla Firefox:

    >>> anon_browser.open('http://launchpad.dev/firefox/+bugs-text')
    >>> anon_browser.url
    'http://launchpad.dev/firefox/+bugs-text'
    >>> print anon_browser.headers['content-type']
    text/plain;charset=utf-8 

    >>> print anon_browser.contents
    5
    4


== Private bugs ==

When a bug is private, the textual description reflects this:

    >>> admin_browser.open('http://launchpad.dev/bugs/14/+text')
    >>> print admin_browser.contents
    bug: 14
    title: jokosher exposes personal details in its actions portlet
    date-reported: Thu, 09 Aug 2007 11:39:16 -0000
    date-updated: Thu, 09 Aug 2007 11:39:16 -0000
    reporter: Karl Tilbury (karl)
    duplicate-of:
    duplicates:
    private: yes
    security: yes
    attachments:
    tags: lunch-money
    subscribers:
        Karl Tilbury (karl)
        Dafydd Harries (daf)
    <BLANKLINE>
    task: jokosher
    status: New
    date-created: Thu, 09 Aug 2007 11:39:16 -0000
    reporter: Karl Tilbury (karl)
    importance: Undecided
    assignee:
    milestone:
    <BLANKLINE>
    Content-Type: multipart/mixed; boundary="...
    MIME-Version: 1.0
    <BLANKLINE>
    --...
    Content-Type: text/plain; charset="utf-8"
    Content-Transfer-Encoding: quoted-printable
    <BLANKLINE>
    Jokosher discloses to any passerby the fact that I am single and unwed
    in its actions portlet. Please fix this blatant violacion of privacy
    now!!
    --...

