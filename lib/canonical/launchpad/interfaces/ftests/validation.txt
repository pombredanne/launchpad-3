= Launchpad field validators =

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.interfaces import (
    ...     CreateBugParams, IOpenLaunchBag, IPersonSet, IProductSet)

== can_be_nominated_for_serieses ==

This validator is used to check if the bug in the launchbag can be
nominated for the given series.

    >>> from canonical.launchpad.interfaces import (
    ...     can_be_nominated_for_serieses)

If we create a new bug, all the target's serieses can be nominated.

    >>> login('no-priv@canonical.com')
    >>> no_priv = getUtility(IPersonSet).getByEmail(
    ...     'no-priv@canonical.com')
    >>> firefox = getUtility(IProductSet).getByName('firefox')
    >>> bug = firefox.createBug(
    ...     CreateBugParams(no_priv, "New Bug", comment="New Bug."))
    >>> getUtility(IOpenLaunchBag).add(bug)

    >>> can_be_nominated_for_serieses(firefox.serieses)
    True

If we nominate the bug for one of the series, the validation will
fail for that specific series.

    >>> nomination = bug.addNomination(no_priv, firefox.serieses[0])
    >>> can_be_nominated_for_serieses(firefox.serieses)
    Traceback (most recent call last):
    ...
    LaunchpadValidationError...

    >>> can_be_nominated_for_serieses([firefox.serieses[0]])
    Traceback (most recent call last):
    ...
    LaunchpadValidationError...

It will pass for the rest of the series, though.

    >>> can_be_nominated_for_serieses(firefox.serieses[1:])
    True

Of course, if we accept the nomination, the validation will still
fail:

    >>> login('foo.bar@canonical.com')
    >>> foo_bar =  getUtility(IPersonSet).getByEmail(
    ...     'foo.bar@canonical.com')
    >>> nomination.approve(foo_bar)
    >>> can_be_nominated_for_serieses([firefox.serieses[0]])
    Traceback (most recent call last):
    ...
    LaunchpadValidationError...

The validation message will contain all the series that can't be
nominated.

    >>> trunk_nomination = bug.addNomination(
    ...     no_priv, firefox.serieses[1])
    >>> can_be_nominated_for_serieses(firefox.serieses)
    Traceback (most recent call last):
    ...
    LaunchpadValidationError:
    This bug has already been nominated for these series: 1.0, Trunk

The validation will still fail if a nomination is declined.

    >>> trunk_nomination.decline(foo_bar)
    >>> can_be_nominated_for_serieses([firefox.serieses[1]])
    Traceback (most recent call last):
    ...
    LaunchpadValidationError...

== PersonNameField ==

The PersonNameField class, which is only used for extra validation on a
person's/team's name.

All persons have a unique name in launchpad, so to allow them to change
their names, we must make sure that name is not already in use by someone
else.

    >>> login('no-priv@canonical.com')
    >>> lifeless = getUtility(IPersonSet).getByName('lifeless')
    >>> from canonical.launchpad.interfaces.person import PersonNameField
    >>> field = PersonNameField(
    ...     __name__='name', title=u'Unique name', description=u'',
    ...     readonly=False, required=True)
    >>> field = field.bind(lifeless)
    >>> field.context == lifeless
    True

You can always use your own name.

    >>> field.validate(lifeless.name)

Or a name that is not already in use.

    >>> field.validate(u'namenotinuse')

But you can't use Mark's name, of course. ;)

    >>> field.validate(u'sabdfl')
    Traceback (most recent call last):
      ...
    LaunchpadValidationError: ...sabdfl is already in use by another
    person or team...
