<div
  tal:omit-tag=""
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="
    bug context/bug|context;
    direct_subscriptions view/getSortedDirectSubscriptions;
    from_dupes_subscriptions view/getSortedSubscriptionsFromDuplicates;
    also_notified_subscribers bug/getAlsoNotifiedSubscribers
  ">
  <div class="section" id="subscribers-direct">
    <h2>Subscribers</h2>
      <div id="subscribers-links">
      <div
        tal:condition="direct_subscriptions"
        tal:repeat="subscription direct_subscriptions"
        tal:attributes="id string:subscriber-${subscription/person/name}"
      >
        <metal:subscriber  metal:define-macro="subscriber-row">

            <a
               tal:condition="subscription/person/name|nothing"
               style="clear: both; float: left;"
               tal:attributes="
                 href subscription/person/fmt:url;
                 title subscription/display_subscribed_by;
               "
            >
              <tal:block replace="structure subscription/person/image:icon" />
              <tal:block replace="subscription/person/fmt:displayname/fmt:shorten/20" />
            </a>
            <a tal:condition="python: subscription.canBeUnsubscribedByUser(view.user)"
               href="+subscribe"
               style="float: right"
               tal:attributes="title string:Unsubscribe ${subscription/person/fmt:displayname};
                               id string:unsubscribe-${subscription/person/name}">
              <img src="/@@/remove"
                tal:attributes="id string:unsubscribe-icon-${subscription/person/name}" />
            </a>

        </metal:subscriber>
      </div>
      </div>
      <div id="none-subscribers"
        tal:condition="not:direct_subscriptions">None</div>
  </div>
  <div
    tal:condition="from_dupes_subscriptions"
    id="subscribers-from-duplicates"
    class="section"
  >
    <h2>From duplicates</h2>
    <div tal:repeat="subscription from_dupes_subscriptions">
      <metal:subscriber metal:use-macro="template/macros/subscriber-row" />
    </div>
  </div>
  <div
    tal:condition="also_notified_subscribers"
    id="subscribers-indirect"
    class="Section"
  >
    <h2>Also notified</h2>
    <div
      tal:repeat="subscriber also_notified_subscribers"
      tal:content="structure subscriber/fmt:link"
    />
  </div>
</div>
