<tal:language-code
  define="language_code context/pofile/language/code">
<tr class="translation">
  <td class="icon left right">
    <a tal:attributes="href view/zoom_url"><img tal:attributes="
          alt view/zoom_alt;
          title view/zoom_alt;
          src view/zoom_icon;" /></a>
  </td>
  <td style="text-align: right;">
    <div tal:attributes="id string:${view/html_id}">
      <span tal:replace="view/sequence">1</span>.
      <input
        type="hidden"
        tal:condition="view/form_is_writeable"
        tal:attributes="name string:${view/html_id}"
        />
    </div>
  </td>
  <th>
    <label class="language-code" tal:condition="not:view/is_plural">
      English:
    </label>
    <label class="language-code" tal:condition="view/is_plural">
      English singular:
    </label>
  </th>
  <td class="icon left right">
    <img
      tal:condition="context/potmsgset/is_translation_credit"
      src="/@@/read-only"
      alt="This message is handled automatically by Launchpad."
      title="This message is handled automatically by Launchpad."
    />
    <tal:form-writeable condition="view/form_is_writeable">
      <a href=""
         tal:condition="not:context/potmsgset/is_translation_credit"
         tal:attributes="
           onClick string:
             javascript:copyInnerHTMLById(
               '${view/html_id}_singular',
               '${view/html_id_singular}_new');;
             selectWidget('${view/html_id_singular}_new_select', event);;
             return false;;
         "><img alt="Copy text" title="Copy text" src="/@@/copy"></a>
    </tal:form-writeable>
  </td>
  <td>
    <div tal:content="structure view/singular_text"
         tal:attributes="id string:${view/html_id}_singular">
      The original text.
    </div>
  </td>
</tr>
<tr class="secondary translation" tal:condition="view/is_plural">
  <th colspan="3">
    <label>English plural:</label>
  </th>
  <td class="icon left right">
    <tal:form-writeable condition="view/form_is_writeable">
    <a href=""
       tal:attributes="
         onClick string:
           javascript:writeTextIntoPluralTranslationFields(
             '${view/html_id}_plural',
             '${view/html_id}_${language_code}_translation_',
             ${context/pluralforms});;
           return false;;
      "><img alt="Copy text" title="Copy text" src="/@@/copy"></a>
    </tal:form-writeable>
  </td>
  <td>
    <div tal:content="structure view/plural_text"
         tal:attributes="id string:${view/html_id}_plural">
      plural source
    </div>
  </td>
</tr>
<tr class="discreet secondary translation"
    tal:condition="context/potmsgset/context">
  <th colspan="3">Context:</th>
  <td />
  <td>
    <div tal:content="context/potmsgset/context"
         tal:attributes="id string:${view/html_id}_context">
      Context
    </div>
  </td>
</tr>
<tr
  tal:condition="view/source_comment"
  class="discreet secondary translation">
  <td colspan="3" />
  <th class="icon left right">
    <img alt="Developer note:" src="/@@/info"
         title="This is a note to translators by the software developer" />
  </th>
  <td tal:content="view/source_comment">
      This refers to the content type.
  </td>
</tr>
<tr
  tal:condition="view/text_has_tab"
  class="discreet secondary translation">
  <td colspan="3" />
  <th class="icon left right">
    <img alt="Note:" src="/@@/info" title="This is a note to translators" />
  </th>
  <td>
    <code>[tab]</code> represents a tab character.
    Please write it exactly the same way, <code>[tab]</code>, in your
    translation.
  </td>
</tr>
<tr
  tal:condition="view/text_has_newline"
  class="discreet secondary translation"
>
  <td colspan="3" />
  <th class="icon left right">
    <img alt="Note:" src="/@@/info" title="This is a note to translators" />
  </th>
  <td>
    <img
      alt="There are line breaks here. Each one"
      src="/@@/translation-newline"
    />
    represents a line break.
    Start a new line in the equivalent position in the translation.
  </td>
</tr>
<tr
  tal:condition="view/text_has_leading_or_trailing_space"
  class="discreet secondary translation"
>
  <td colspan="3" />
  <th class="icon left right">
    <img alt="Note:" src="/@@/info" title="This is a note to translators" />
  </th>
  <td>
    <img
      alt="There are leading/trailing spaces here. Each one"
      src="/@@/translation-space"
    />
    represents a space character.
    Enter a space in the equivalent position in the translation.
  </td>
</tr>
<tr class="error translation" tal:condition="view/error">
  <th colspan="3" >
    <strong>Error in Translation:</strong>
  </th>
  <td />
  <td>
    <div>
        <span tal:replace="view/error" />
      </div>
  </td>
</tr>
  <tal:translation-dictionaries
       repeat="translation_dictionary view/translation_dictionaries">
  <tal:plural-form define="plural_index translation_dictionary/plural_index">
    <tr class="secondary translation">
      <th colspan="3">
        <label class="language-code">Current
          <span tal:replace="context/pofile/language/englishname">
            Welsh
          </span><span tal:replace="string:[${plural_index}]"
                       tal:condition="view/is_plural">[0]</span>:
        </label>
      </th>
      <tal:not-locked condition="not:context/potmsgset/is_translation_credit">
        <tal:with-content
             condition="translation_dictionary/active_translation">
          <td class="icon left right">
            <tal:form-writeable condition="view/form_is_writeable">
            <tal:user-is-official-translator condition="view/user_is_official_translator">
              <input
                type="radio"
                checked="true"
                tal:attributes="
                  name string:${translation_dictionary/html_id_translation}_radiobutton;
                  id string:${translation_dictionary/html_id_translation}_radiobutton;
                  value string:${translation_dictionary/html_id_translation};
                  onClick string:
                    javascript:copyInnerHTMLById(
                      '${translation_dictionary/html_id_translation}',
                      '${translation_dictionary/html_id_translation}_new')
                " />
            </tal:user-is-official-translator>
            <tal:is-not-editor condition="not:view/user_is_official_translator">
              <a href=""
                 tal:attributes="
                   onClick string:
                     javascript:copyInnerHTMLById(
                       '${translation_dictionary/html_id_translation}',
                       '${translation_dictionary/html_id_translation}_new');;
                     selectWidget('${translation_dictionary/html_id_translation}_new_select', event);;
                     return false;;
                 "><img alt="Copy text" title="Copy text" src="/@@/copy"></a>
            </tal:is-not-editor>
            </tal:form-writeable>
          </td>
          <td>
            <div tal:content="structure translation_dictionary/active_translation"
                 tal:condition="not: view/user_is_official_translator"
                 tal:attributes="
                   lang context/pofile/language/dashedcode;
                   dir context/pofile/language/abbreviated_text_dir;
                   id string:${translation_dictionary/html_id_translation}">
              current translation
            </div>
            <label
              style="white-space: normal"
              tal:content="structure translation_dictionary/active_translation"
              tal:condition="view/user_is_official_translator"
              tal:attributes="
                lang context/pofile/language/dashedcode;
                dir context/pofile/language/abbreviated_text_dir;
                id string:${translation_dictionary/html_id_translation};
                for string:${translation_dictionary/html_id_translation}_radiobutton">
              current translation
            </label>
          </td>
        </tal:with-content>
        <tal:without-content
          condition="not: translation_dictionary/active_translation">
          <td class="icon left right">
            <tal:user-is-official-translator condition="view/user_is_official_translator">
              <input
                type="radio"
                checked="true"
                tal:attributes="
                  name string:${translation_dictionary/html_id_translation}_radiobutton;
                  id string:${translation_dictionary/html_id_translation}_radiobutton;
                  value string:${translation_dictionary/html_id_translation}
              " />
            </tal:user-is-official-translator>
          </td>
          <td>
            <div tal:condition="not: view/user_is_official_translator"
                 tal:attributes="
                   id string:${translation_dictionary/html_id_translation}">
              (no translation yet)
            </div>
            <label tal:condition="view/user_is_official_translator"
                   tal:attributes="
                     id string:${translation_dictionary/html_id_translation};
                     for string:${translation_dictionary/html_id_translation}_radiobutton">
              (no translation yet)
            </label>
          </td>
        </tal:without-content>
      </tal:not-locked>
      <tal:locked condition="context/potmsgset/is_translation_credit">
        <td class="icon left right" />
        <td>
          <tal:form-writeable condition="view/form_is_writeable">
            <tal:automatic condition="view/translation_credits">
              <div tal:condition="not: view/user_is_official_translator"
                   tal:attributes="
                     id string:${translation_dictionary/html_id_translation}"
                   tal:content="structure view/translation_credits">
                translation credits
              </div>
              <label tal:condition="view/user_is_official_translator"
                     tal:attributes="
                       id string:${translation_dictionary/html_id_translation};
                       for string:${translation_dictionary/html_id_translation}_radiobutton"
                     tal:content="structure view/translation_credits">
                translation credits
              </label>
            </tal:automatic>
            <tal:no-automatic condition="not:view/translation_credits">
              <div tal:condition="not:view/user_is_official_translator"
                   tal:attributes="
                     id string:${translation_dictionary/html_id_translation}">
                (no translation yet)
              </div>
              <label tal:condition="view/user_is_official_translator"
                     tal:attributes="
                       id string:${translation_dictionary/html_id_translation};
                        for string:${translation_dictionary/html_id_translation}_radiobutton">
                (no translation yet)
              </label>
            </tal:no-automatic>
          </tal:form-writeable>
          <tal:form-not-writeable condition="not:view/form_is_writeable">
            <div tal:condition="not: view/user_is_official_translator"
                 tal:attributes="
                   id string:${translation_dictionary/html_id_translation}"
                 tal:content="structure translation_dictionary/active_translation">
              translation credits
            </div>
            <label tal:condition="view/user_is_official_translator"
                   tal:attributes="
                     id string:${translation_dictionary/html_id_translation};
                     for string:${translation_dictionary/html_id_translation}_radiobutton"
                   tal:content="structure translation_dictionary/active_translation">
              translation credits
            </label>
          </tal:form-not-writeable>
        </td>
      </tal:locked>
    </tr>

    <tal:active-submission
      define="active_submission translation_dictionary/active_submission"
      condition="active_submission">
      <tr tal:condition=
            "not:translation_dictionary/same_translator_and_reviewer"
          class="discreet secondary translation">
	<td colspan="4" />
        <td id="translated_by" style="overflow: auto;">
          Translated by
          <a tal:content="active_submission/person/browsername"
             tal:attributes="href active_submission/person/fmt:url">Foo Bar</a>
          <span
            tal:attributes="title active_submission/datecreated/fmt:datetime"
            tal:content="active_submission/datecreated/fmt:displaydate">
            on 2006-08-05
          </span>
        </td>
      </tr>
      <tr class="discreet secondary translation"
          tal:condition="context/reviewer">
	<td colspan="4" />
        <td tal:condition="translation_dictionary/same_translator_and_reviewer"
            id="translated_and_reviewed_by"
            style="overflow: auto">
          Translated and reviewed by
          <a tal:content="context/reviewer/browsername"
             tal:attributes="href context/reviewer/fmt:url">Foo Bar</a>
          <span
            tal:attributes="title context/date_reviewed/fmt:datetime"
            tal:content="context/date_reviewed/fmt:displaydate">
            on 2006-08-05
          </span>
        </td>
        <td tal:condition=
              "not:translation_dictionary/same_translator_and_reviewer"
            id="reviewed_by"
            style="overflow: auto">
          Reviewed by
          <a tal:content="context/reviewer/browsername"
             tal:attributes="href context/reviewer/fmt:url">Foo Bar</a>
          <span
            tal:attributes="title context/date_reviewed/fmt:datetime"
            tal:content="context/date_reviewed/fmt:displaydate">
            on 2006-08-05
          </span>
        </td>
      </tr>
    </tal:active-submission>
    <tal:published-submission
      define="submission translation_dictionary/published_submission"
      condition="submission">
  <tr class="secondary"
    tal:attributes="id string:msgset_${context/potmsgset/id}_packaged">
    <th colspan="3">
      Packaged:
    </th>
    <td class="icon left right">
      <tal:form-writeable condition="view/form_is_writeable">
      <tal:user-is-official-translator
        condition="view/user_is_official_translator">
        <input
          type="radio"
          tal:attributes="
            name string:msgset_${context/potmsgset/id}_${language_code}_translation_${plural_index}_radiobutton;
            id string:msgset_${context/potmsgset/id}_${language_code}_suggestion_${submission/id}_${plural_index}_radiobutton;
            value string:msgset_${context/potmsgset/id}_${language_code}_suggestion_${submission/id}_${plural_index};
            onClick string:
              javascript:copyInnerHTMLById(
                'msgset_${context/potmsgset/id}_${language_code}_suggestion_${submission/id}_${plural_index}',
                'msgset_${context/potmsgset/id}_${language_code}_translation_${plural_index}_new')
            " />
      </tal:user-is-official-translator>
      <tal:user-is-not-official-translator condition="not:view/user_is_official_translator">
        <a href=""
          tal:attributes="
            onClick string:
              javascript:copyInnerHTMLById(
                'msgset_${context/potmsgset/id}_${language_code}_suggestion_${submission/id}_${plural_index}',
                'msgset_${context/potmsgset/id}_${language_code}_translation_${plural_index}_new');;
              selectWidget('msgset_${context/potmsgset/id}_${language_code}_translation_${plural_index}_new_select', event);;
            return false;;
          "><img alt="Copy text" title="Copy text" src="/@@/copy"></a>
      </tal:user-is-not-official-translator>
      </tal:form-writeable>
    </td>
    <td>
      <div
        tal:condition="not:view/user_is_official_translator"
        tal:attributes="
          lang context/pofile/language/dashedcode;
          dir context/pofile/language/abbreviated_text_dir;
          id string:msgset_${context/potmsgset/id}_${language_code}_suggestion_${submission/id}_${plural_index}"
        tal:content="structure translation_dictionary/published_translation">
        published translation
      </div>
      <label
        style="white-space: normal"
        tal:condition="view/user_is_official_translator"
        tal:attributes="
          lang context/pofile/language/dashedcode;
          dir context/pofile/language/abbreviated_text_dir;
          id string:msgset_${context/potmsgset/id}_${language_code}_suggestion_${submission/id}_${plural_index};
          for string:msgset_${context/potmsgset/id}_${language_code}_suggestion_${submission/id}_${plural_index}_radiobutton;"
        tal:content="structure translation_dictionary/published_translation">
        published translation
      </label>
    </td>
  </tr>
  <tr class="discreet secondary"
    tal:attributes="id string:msgset_${context/potmsgset/id}_packaged_origin">
    <td colspan="4" class="icon left right" />
    <td style="overflow: auto;">
      Translated by
      <a tal:content="submission/person/browsername"
         tal:attributes="href submission/person/fmt:url">Foo Bar</a>
      <span
        tal:attributes="title submission/datecreated/fmt:datetime"
        tal:content="submission/datecreated/fmt:displaydate">
        2006-08-05
      </span>
    </td>
  </tr>

    </tal:published-submission>
    <tal:locked condition="not:context/potmsgset/is_translation_credit">
      <tal:suggestions-title
         condition="translation_dictionary/suggestions_count">
      <tr class="secondary">
        <th colspan="3"
          tal:attributes="rowspan python:translation_dictionary['suggestions_count']*2+1;">
            Suggestions:</th>
      </tr>
      </tal:suggestions-title>
      <tal:suggestion_block
           define="suggestion_block translation_dictionary/suggestion_block">
        <tal:suggestions repeat="suggestions suggestion_block">
          <div tal:replace="structure suggestions/@@+display" />
        </tal:suggestions>
      </tal:suggestion_block>
      <tr class="secondary translation"
          tal:condition="view/form_is_writeable">
        <th colspan="3">
          <label
            tal:condition="not:view/user_is_official_translator"
            tal:attributes="
              for string:${translation_dictionary/html_id_translation}_new_select;
              " >New suggestion:</label>
          <label
            tal:condition="view/user_is_official_translator"
            tal:attributes="
              for string:${translation_dictionary/html_id_translation}_new_select;
              " >New translation:</label>
        </th>
        <td class="icon left right">
          <tal:user-is-official-translator condition="view/user_is_official_translator">
            <input
              type="radio"
              tal:attributes="
                name string:${translation_dictionary/html_id_translation}_radiobutton;
                id string:${translation_dictionary/html_id_translation}_new_select;
                value string:${translation_dictionary/html_id_translation}_new;
                onClick string:javascript:setFocusByName('${translation_dictionary/html_id_translation}_new');
              " />
          </tal:user-is-official-translator>
          <tal:user-is-not-official-translator condition="not:view/user_is_official_translator">
            <input
              type="checkbox"
              tal:attributes="
                checked translation_dictionary/store_flag;
                name string:${translation_dictionary/html_id_translation}_new_checkbox;
                id string:${translation_dictionary/html_id_translation}_new_select;
                onClick string:javascript:setFocusByName('${translation_dictionary/html_id_translation}_new');
              " />
          </tal:user-is-not-official-translator>
        </td>
        <td>
          <input
            style="width: 100%;"
            type="text"
            tal:condition="not:translation_dictionary/is_multi_line"
            tal:attributes="
              name string:${translation_dictionary/html_id_translation}_new;
              id string:${translation_dictionary/html_id_translation}_new;
              lang context/pofile/language/dashedcode;
              dir context/pofile/language/abbreviated_text_dir;
              value translation_dictionary/translation;
              onKeyPress string:javascript:selectWidget('${translation_dictionary/html_id_translation}_new_select', event);
              onChange string:javascript:selectWidget('${translation_dictionary/html_id_translation}_new_select', event);
              " />
          <input type="button" value="Add more lines" title="Lets you add more than one line"
            tal:condition="not:translation_dictionary/is_multi_line"
            tal:attributes="
              name string:${translation_dictionary/html_id_translation}_new_to_textarea;
              id string:${translation_dictionary/html_id_translation}_new_to_textarea;
              onClick string:javascript:upgradeToTextAreaForTranslation('${translation_dictionary/html_id_translation}_new');"
            />
          <tal:multi-line condition="translation_dictionary/is_multi_line">
            <tal:with-content
              condition="translation_dictionary/translation">
              <tal:comment tal:replace="nothing">
                We don't use textarea's tal:content tag because tal is not
                generating the right html tags for translations (new lines
                matter). Also, the lack of indentation for tal:content is
                deliberate or we would add extra whitespaces to the textarea,
                which causes us to potentially corrupt translations. You can
                read more about this on:
                https://bugzilla.mozilla.org/show_bug.cgi?id=299009
              </tal:comment>
              <textarea
                style="width: 100%;"
                rows=6
                tal:attributes="
                  id string:${translation_dictionary/html_id_translation}_new;
                  name string:${translation_dictionary/html_id_translation}_new;
                  lang context/pofile/language/dashedcode;
                  dir context/pofile/language/abbreviated_text_dir;
                  onKeyPress string:javascript:selectWidget('${translation_dictionary/html_id_translation}_new_select', event);
                  onChange string:javascript:selectWidget('${translation_dictionary/html_id_translation}_new_select', event);
                ">
<tal:content replace="translation_dictionary/translation" /></textarea>
            </tal:with-content>
            <tal:without-content
              condition="not: translation_dictionary/translation">
              <tal:comment tal:replace="nothing">
                We are using an special case if we don't have any content for this
                textarea because tal expressions leave empty lines behind so we
                get new lines added to the textarea for free and that causes
                erroneous translations.
              </tal:comment>
              <textarea
                style="width: 100%;"
                rows=6
                tal:attributes="
                  id string:${translation_dictionary/html_id_translation}_new;
                  name string:${translation_dictionary/html_id_translation}_new;
                  lang context/pofile/language/dashedcode;
                  dir context/pofile/language/abbreviated_text_dir;
                  onKeyPress string:javascript:selectWidget('${translation_dictionary/html_id_translation}_new_select', event);
                  onChange string:javascript:selectWidget('${translation_dictionary/html_id_translation}_new_select', event);
                "></textarea>
            </tal:without-content>
          </tal:multi-line>
        </td>
    </tr>
  </tal:locked>
  </tal:plural-form>
  </tal:translation-dictionaries>
  <tr class="secondary">
    <td colspan="4" />
    <td>
      <div tal:condition="view/user_is_official_translator">
       <tal:not-locked condition="not:context/potmsgset/is_translation_credit">
         <label class="fuzzy-checkbox">
           <input
             type="checkbox"
             value="fuzzy"
             tal:attributes="
               checked view/is_fuzzy;
               name string:${view/html_id}_${language_code}_needsreview"
             />
           <tal:block condition="not:view/is_plural">
             Someone should review this translation
           </tal:block>
           <tal:block condition="view/is_plural">
             Someone should review these translations
           </tal:block>
         </label>
       </tal:not-locked>
       <tal:locked condition="context/potmsgset/is_translation_credit">
         <tal:comment condition="nothing">
           We can't reliably export any credits when upstream translation is
           fuzzy (eg. we might use the same algorithm in that case, but then
           upstreams will complain that we got it wrong; or, we might discard
           their credits altogether, when they will complain that we just credit
           ourselves; so, lets not change the fuzzy flag, and rather keep it,
           since we are mostly automating this to fix our issues with upstreams,
           and I'd rather not introduce more issues with them).
         </tal:comment>
         <label class="fuzzy-checkbox">
           <input
             type="checkbox"
             value="fuzzy"
	     disabled="1"
             tal:attributes="
               checked view/is_fuzzy;
               name string:msgset_${context/potmsgset/id}_${language_code}_needsreview"
             />
             Someone should review these translation credits
         </label>
       </tal:locked>
      </div>
      <div tal:condition="not: view/user_is_official_translator">
        <label tal:condition="view/is_fuzzy">
          <tal:block condition="not:view/is_plural">
            Someone should review this translation
          </tal:block>
          <tal:block condition="view/is_plural">
            Someone should review these translations
          </tal:block>
        </label>
      </div>
    </td>
  </tr>
<tr tal:condition="view/comment" class="secondary">
  <th colspan="3"><label>Translator note:</label></th>
  <td />
  <td tal:content="view/comment">
    Translator comment.
  </td>
</tr>
<tr class="discreet secondary" tal:condition="view/file_references">
  <td colspan="4" />
  <td style="padding-bottom: 1em; overflow: auto;">
    Located in
    <tal:location content="view/file_references">
      ./plone_forms/discussion_reply_form.pt
    </tal:location>
  </td>
</tr>
</tal:language-code>
