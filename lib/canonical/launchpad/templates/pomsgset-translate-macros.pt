<metal:suggestions define-macro="translation-suggestions">
  <tal:comment replace="nothing">
  This macro expects the following variables defined:
      :pomsgset_view: An IPOMsgSet View.
      :submissions: A list of IPOSubmission objects.
  </tal:comment>
  <tal:block condition="submissions">
    <tr class="secondary">
      <th colspan="3" style="border: inherit;">
        <label><metal:title define-slot="suggestion-title" />:</label>
      </th>
      <td class="icon left right" />
      <td>
        <tal:submission repeat="submission submissions">
          <div
            tal:define="submissionlang submission/pomsgset/pofile/language"
            tal:attributes="
              lang submissionlang/dashedcode;
              dir submissionlang/abbreviated_text_dir
            "
            tal:content=
              "structure submission/potranslation/translation/fmt:text-to-html"
            >suggestion</div>
          <div class="discreet">
            &mdash;
            <a tal:content="submission/person/browsername"
               tal:attributes="href submission/person/fmt:url">Foo Bar</a>
          </div>
        </tal:submission>
      </td>
    </tr>
  </tal:block>
</metal:suggestions>
<metal:pomsgset define-macro="pomsgset-view">
  <tal:comment replace="nothing">
  This macro expects the following variable defined:
      :pomsgset_view: An IPOMsgSet View.
  </tal:comment>
  <tr>
    <td style="text-align: right;">
      <span tal:replace="pomsgset_view/sequence">1</span>.
      <input
        type="hidden"
        tal:attributes="
        name string:msgset_${pomsgset_view/potmsgset/id}"
        />
    </td>
    <td>
      <a tal:attributes="href pomsgset_view/zoom_url">
        <img tal:attributes="
          alt pomsgset_view/zoom_alt;
          title pomsgset_view/zoom_alt;
          src pomsgset_view/zoom_icon;" /></a>
    </td>
    <th style="border-style: dotted; border-width: 1px 0 0;">
      <label class="language-code" tal:condition="not:pomsgset_view/is_plural">
        English:
      </label>
      <label class="language-code" tal:condition="pomsgset_view/is_plural">
        English singular:
      </label>
    </th>
    <td class="icon left right">
      <input type="image" src="/@@/copy.png" title="Copy text"
        tal:attributes="name string:copy_${pomsgset_view/potmsgset/id}_singular"
        />
    </td>
    <td tal:content="structure pomsgset_view/msgid">
      The original text.
    </td>
  </tr>
  <tr class="secondary" tal:condition="pomsgset_view/is_plural">
    <th colspan="3">
      <label>English plural:</label>
    </th>
    <td class="icon left right">
      <input type="image" src="/@@/copy.png" title="Copy text"
        tal:attributes="name string:copy_${pomsgset_view/potmsgset/id}_plural"
        />
    </td>
    <td tal:content="structure pomsgset_view/msgid_plural">
      plural source
    </td>
  </tr>
  <tr class="discreet secondary" tal:condition="pomsgset_view/msgid_has_tab">
    <td colspan="4" />
    <td>
      <img
        alt="Note:"
        src="/@@/info_icon.gif"
        title="This is a note to translators"
        />
      <code>[tab]</code> represents a tab character.
      Please write it exactly the same way, <code>[tab]</code>, in your
      translation.
    </td>
  </tr>
  <tr class="discreet secondary" tal:condition="pomsgset_view/source_comment">
    <td colspan="4" />
    <td>
      <img
        alt="Developer note:"
        src="/@@/info_icon.gif"
        title="This note was provided by the software developer."
        />
      <span
        tal:content="pomsgset_view/source_comment"
        tal:omit-tag="">
        This refers to the content type.
      </span>
    </td>
  </tr>
  <tr class="error" tal:condition="pomsgset_view/error">
    <td />
    <th colspan="2">
          <strong>Error in Translation:</strong>
    </th>
    <td colspan="3">
      <div>
          <span tal:replace="pomsgset_view/error" />
        </div>
    </td>
  </tr>
  <tal:language-code
    define="language_code pomsgset_view/pofile/language/code">
  <tal:plural-forms repeat="index pomsgset_view/translation_range">
    <tr class="secondary">
      <th colspan="3">
        <label class="language-code">
          <span tal:replace="pomsgset_view/pofile/language/englishname">
            Welsh
          </span><span tal:replace="string:[${index}]"
                       tal:condition="pomsgset_view/is_plural">[0]</span>:
        </label>
      </th>
      <td>
        <!-- will eventually contain copy buttons -->
      </td>
      <td>
        <tal:comment tal:replace="nothing">
          XXX: Carlos Perello Marin 2005-05-05
          This 'python:' expression should be fixed by SteveA.
        </tal:comment>
        <tal:with-content condition="python:pomsgset_view.getTranslation(index)">
          <tal:comment tal:replace="nothing">
            The lack of indentation for tal:content is deliberate or we would
            add extra whitespaces to the textarea, which causes us to
            potentially corrupt translations.
            https://bugzilla.mozilla.org/show_bug.cgi?id=299009
          </tal:comment>
          <textarea
            style="width: 100%;"
            rows="12"
            tal:attributes="
              name string:msgset_${pomsgset_view/potmsgset/id}_${language_code}_translation_${index};
              tabindex view/generateNextTabIndex;
              lang pomsgset_view/pofile/language/dashedcode;
              dir pomsgset_view/pofile/language/abbreviated_text_dir;
              ">
<tal:content replace="python:pomsgset_view.getTranslation(index)" /></textarea>
        </tal:with-content>
        <tal:without-content condition="python:not pomsgset_view.getTranslation(index)">
          <tal:comment tal:replace="nothing">
            XXX: Carlos Perello Marin 2005-05-05
            This 'python:' expression should be fixed by SteveA.

            We are using an special case if we don't have any content for this
            textarea because tal expressions leave empty lines behind so we
            get new lines added to the textarea for free and that causes
            erroneous translations.
          </tal:comment>
          <textarea
            style="width: 100%;"
            rows=12
            tal:attributes="
              name string:msgset_${pomsgset_view/potmsgset/id}_${language_code}_translation_${index};
              tabindex view/generateNextTabIndex;
              lang pomsgset_view/pofile/language/dashedcode;
              dir pomsgset_view/pofile/language/abbreviated_text_dir;
              "></textarea>
        </tal:without-content>
      </td>
    </tr>
    <tal:block
      define="submissions python:pomsgset_view.get_suggested_submissions(index)">
      <metal:submissions
        use-macro="submissions/@@+pomsgset-translate/translation-suggestions">
        <metal:fill metal:fill-slot="suggestion-title">Suggestions</metal:fill>
      </metal:submissions>
    </tal:block>
    <tal:block
      define="submissions python:pomsgset_view.get_current_submissions(index)">
      <metal:submissions
        use-macro="submissions/@@+pomsgset-translate/translation-suggestions">
        <metal:fill
          metal:fill-slot="suggestion-title">Used elsewhere</metal:fill>
      </metal:submissions>
    </tal:block>
    <tal:block
      define="submissions python:pomsgset_view.get_wiki_submissions(index)">
      <metal:submissions
        use-macro="submissions/@@+pomsgset-translate/translation-suggestions">
        <metal:fill
          metal:fill-slot="suggestion-title">Suggested elsewhere</metal:fill>
      </metal:submissions>
    </tal:block>
    <tal:block
      define="submissions
      python:pomsgset_view.get_alternate_language_submissions(index)">
      <metal:submissions
        use-macro="submissions/@@+pomsgset-translate/translation-suggestions">
        <metal:fill metal:fill-slot="suggestion-title"><span
          tal:replace="pomsgset_view/second_lang_pofile/language/englishname"
          /> (Alternate Language)</metal:fill>
      </metal:submissions>
    </tal:block>
    </tal:plural-forms>
    <tr class="secondary">
      <td colspan="4" />
      <td>
        <div>
          <label class="fuzzy-checkbox">
            <input
              type="checkbox"
              value="fuzzy"
              tal:attributes="
                checked pomsgset_view/is_fuzzy;
                name string:msgset_${pomsgset_view/potmsgset/id}_${language_code}_needsreview;
                tabindex view/generateNextTabIndex
                " />
            <tal:block condition="not:pomsgset_view/is_plural">
              Someone should review this translation
            </tal:block>
            <tal:block condition="pomsgset_view/is_plural">
              Someone should review these translations
            </tal:block>
          </label>
        </div>
      </td>
    </tr>
    </tal:language-code>
  <tr tal:condition="pomsgset_view/comment" class="secondary">
    <th colspan="3"><label>Translator note:</label></th>
    <td />
    <td tal:content="pomsgset_view/comment">
      Translator comment.
    </td>
  </tr>
  <tr class="discreet secondary">
    <th colspan="3" style="padding-bottom: 1em;">
      Located in:
    </th>
    <td class="icon left right" />
    <td style="overflow: auto;" tal:content="pomsgset_view/file_references">
      ./plone_forms/discussion_reply_form.pt
    </td>
  </tr>
</metal:pomsgset>
