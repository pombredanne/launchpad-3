= Karma for branch related activity =

We want people to register their branches on Launchpad, and also to
link their branches to bugs and specs, so we give them some karma for
it.  By linking bugs and specs to branches the users are enriching
the information that Launchpad has about the work going on in the
branches.  We want to encourage the linking of information, and so
give karma for it.

    >>> from canonical.launchpad.database.karma import KarmaCategory
    >>> code_category = KarmaCategory.byName('code')
    >>> code_karma_actions = code_category.karmaactions
    >>> sorted([action.title for action in code_karma_actions])
    [u'Branch linked to a blueprint',
     u'Branch linked to a bug',
     u'New branch registered',
     u'Revision added']

    >>> from canonical.launchpad.ftests.karma import KarmaAssignedEventListener
    >>> karma_helper = KarmaAssignedEventListener(show_person=True)
    >>> karma_helper.register_listener()

== Registering branches ==

Karma is added for registering a branch.

    >>> login('test@canonical.com')
    >>> from canonical.launchpad.testing import LaunchpadObjectFactory
    >>> factory = LaunchpadObjectFactory()
    >>> fooix = factory.makeProduct(name='fooix')
    >>> eric = factory.makePerson(name='eric', password='test')
    >>> branch = factory.makeBranch(owner=eric, product=fooix)
    Karma added: action=branchcreated, product=fooix, person=eric

However, no karma is added for junk branches.

    >>> junk_branch = factory.makeBranch(
    ...     owner=eric, product=None)


== Linking bugs and branches ==

You get karma for linking a bug to a branch.

    >>> bug = factory.makeBug(product=fooix)
    >>> branch_link = bug.addBranch(branch, eric)
    Karma added: action=bugbranchcreated, product=fooix, person=eric

As long as it is not a junk branch.

    >>> branch_link = bug.addBranch(junk_branch, eric)


== Linking blueprints and branches ==

You get karma for linking a blueprint to a branch.

    >>> blueprint = factory.makeSpecification(product=fooix)
    >>> branch_link = blueprint.linkBranch(branch, eric)
    Karma added: action=specbranchcreated, product=fooix, person=eric

But again, not for junk branches.

    >>> branch_link = blueprint.linkBranch(junk_branch, eric)

    # Unregister the event listener to make sure we won't interfere in
    # other tests.
    >>> karma_helper.unregister_listener()
