= Package Diff =

The 'package-diff' subsystem allows users to request a diff between
two SourcePackageReleases.

The diff can be requested by any user with permission to view both
packages and will be performed frequently by our infrastructure.


== Requesting a Diff ==

First we have to retrieve a SourcePackageRelease from the sampledata,
let's use 'pmount' sources.

    >>> from canonical.launchpad.interfaces import (
    ...     IDistributionSet, IPersonSet)

    >>> ubuntu = getUtility(IDistributionSet).getByName('ubuntu')
    >>> pmount = ubuntu.getSourcePackage('pmount')

    >>> pmount_from = pmount['0.1-2'].sourcepackagerelease
    >>> pmount_to = pmount['0.1-1'].sourcepackagerelease

A packageDiff can be created from the two packages by calling
requestDiffTo(). It takes two arguments: the user requesting the
packageDiff, and the sourcepackagerelease to that has the changes.

Requesting a diff from pmount_0.1-2 to pmount_0.1-1.

    >>> cprov = getUtility(IPersonSet).getByName('cprov')
    >>> package_diff = pmount_from.requestDiffTo(
    ...     requester=cprov, to_sourcepackagerelease=pmount_to)

Let's inspect the PackageDiff record created.

    >>> from canonical.launchpad.interfaces import IPackageDiff
    >>> from canonical.launchpad.webapp.testing import verifyObject

    >>> verifyObject(IPackageDiff, package_diff)
    True

Its main attributes are:

 * 'requester', which maps to a `IPerson`, the user who made the diff
   request.

    >>> from canonical.launchpad.interfaces import IPerson
    >>> verifyObject(IPerson, package_diff.requester)
    True

    >>> print package_diff.requester.displayname
    Celso Providelo

 * 'from_source', which maps to a `ISourcePackageRelease`, the base
   source used in the diff.

    >>> from canonical.launchpad.interfaces import ISourcePackageRelease
    >>> verifyObject(ISourcePackageRelease, package_diff.from_source)
    True

    >>> print package_diff.from_source.title
    pmount - 0.1-2

 * 'to_source', which maps to a `ISourcePackageRelease`, the result
   source used in the diff.

    >>> from canonical.launchpad.interfaces import ISourcePackageRelease
    >>> verifyObject(ISourcePackageRelease, package_diff.to_source)
    True

    >>> print package_diff.to_source.title
    pmount - 0.1-1

Since the PackageDiff was not yet performed, both, 'date_fulfilled'
and 'diff_content' attributes are empty.

    >>> print package_diff.date_fulfilled
    None

    >>> print package_diff.diff_content
    None

IPackageDiff offers a property that return the 'title' of the diff
request.

    >>> print package_diff.title
    Package diff from pmount - 0.1-2 to pmount - 0.1-1

An attempt to record an already recorded DiffRequest will result in an
error:

    >>> dup_diff = pmount_from.requestDiffTo(
    ...     requester=cprov, to_sourcepackagerelease=pmount_to)
    Traceback (most recent call last):
    ...
    PackageDiffAlreadyRequested: Package diff from pmount - 0.1-2 to
    pmount - 0.1-1 was already requested by Celso Providelo


== Performing a Diff ==




== Browsing Diffs ==


