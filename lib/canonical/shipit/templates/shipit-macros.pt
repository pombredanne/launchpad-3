<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  omit-tag="">

<metal:quantity_widgets define-macro="quantity_widgets">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:

    :widgets_matrix: A matrix in which each row contains a ShipItFlavour and
                     one quantity widget for each ShipItArchitecture that we
                     ship CDs. These widgets should always be ordered according
                     to their architectures, and the order should be
                     the same as in view/ordered_architectures.

    :view/ordered_architectures: A list of ShipItArchitecture objects in the
                                 order they should be diplayed in the UI.
  </tal:comment>

  <table tal:attributes="cols view/ordered_architectures/count:len"
         style="width: auto; margin-left: 0">
    <thead>
      <tr>
        <th>&nbsp;</th>
        <tal:headers repeat="arch view/ordered_architectures">
          <th tal:content="arch/title" />
        </tal:headers>
      </tr>
    </thead>
    <tbody>
      <tr tal:repeat="row widgets_matrix">
        <tal:block repeat="cell row">
        <tal:comment replace="nothing">
          We need to save the widget with this nocall: here because if we
          don't do that, our dear zope will turn it into a string for us.
        </tal:comment>
        <tal:save-widget define="widget nocall:cell">

          <tal:is-header condition="repeat/cell/start">
            <th tal:content="cell" style="text-align: right" />
          </tal:is-header>
          <tal:is-not-header condition="not: repeat/cell/start">
            <td style="text-align: center">
              <tal:block condition="cell">
                <span metal:use-macro="context/@@launchpad_widget_macros/display_raw_widget" />
              </tal:block>
              <span tal:condition="not: cell">n/a</span>
            </td>
          </tal:is-not-header>

        </tal:save-widget>
        </tal:block>
      </tr>
    </tbody>
  </table>

</metal:quantity_widgets>


<metal:display_widget define-macro="display_widget">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:
        :widget: The widget that's going to be rendered.
  </tal:comment>

  <th>
    <label
      tal:condition="widget/label"
      tal:attributes="for widget/name"
      tal:content="string:${widget/label}:"
    >Label:</label>
  </th>
  <td>
    <span metal:use-macro="context/@@launchpad_widget_macros/display_raw_widget" />
  </td>
</metal:display_widget>


<metal:shipping_details define-macro="shipping_details">
  <tal:comment replace="nothing">
    This macro expects the view to have the following widgets:
      recipientdisplayname
      organization
      addressline1
      addressline2
      city
      province
      postcode
      country
      phone
  </tal:comment>

    <tr>
      <tal:block tal:define="widget nocall:view/widgets/recipientdisplayname">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/widgets/organization">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/widgets/addressline1">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/widgets/addressline2">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/widgets/city">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/widgets/province">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/widgets/postcode">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/widgets/country">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/widgets/phone">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
</metal:shipping_details>


<metal:previous_requests define-macro="previous_requests">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:
        :account: An IShipitAccount for the logged in user.
  </tal:comment>

  <ul>
    <li tal:repeat="pastorder account/pastShipItRequests">
      <span tal:replace="pastorder/getTotalCDs" /> CDs requested
      <span
        tal:attributes="title pastorder/daterequested/fmt:datetime"
        tal:content="pastorder/daterequested/fmt:displaydate">
        2005-12-31
      </span>.
      <span tal:condition="pastorder/isCancelled">This request was
        cancelled, so no CDs were shipped.</span>
      <tal:notcancelled tal:condition="not: pastorder/isCancelled">
        <tal:shipped condition="pastorder/shipment">
          <span tal:replace="pastorder/getTotalApprovedCDs" />
          CDs were approved and sent to the shipping company
          <span
            tal:attributes="
              title pastorder/shipment/shippingrun/datecreated/fmt:datetime"
            tal:content="
              pastorder/shipment/shippingrun/datecreated/fmt:displaydate">
          2006-02-13
          </span>.
          <strong>Please note requests usually take from 4 to 6 weeks to
            deliver, depending on the country of shipping.</strong>
        </tal:shipped>
        <tal:not-shipped condition="not: pastorder/shipment">
          <span tal:condition="pastorder/isDenied">This request was
            not approved, so no CDs were shipped.</span>
        </tal:not-shipped>
      </tal:notcancelled>
    </li>
  </ul>
</metal:previous_requests>


<metal:meta-master define-macro="meta-master">
<metal:doctype define-slot="doctype"><tal:doctype tal:replace="structure string:&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;" /></metal:doctype>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      tal:attributes="
        lang default_language|default;
        xml:lang default_language|default;"
      tal:define="CONTEXTS python:{'template':template, 'context': context, 'view':view};"
    >

<head>
    <title tal:content="CONTEXTS/fmt:pagetitle">Launchpad</title>

    <metal:extra-head define-slot="extra-head" />
    <metal:block define-slot="head_epilogue"></metal:block>
</head>

  <body>
    <div id="pageWrapper">

      <div id="mastWrapper">
        <div id="masthead">
           <metal:logo define-slot="header-logo" />
           <div id="search">
            <tal:block condition="view/account">
              <form action="/+logout" class="login" method="post">
                Logged in as <span tal:replace="view/account/displayname" />
                  &ndash;
                <input type="submit" value="Log Out" />
              </form>
            </tal:block>

            <tal:block condition="not: view/account">
              Not logged in &#8212;
              <a href="/login">
                Log In / Register
              </a>
            </tal:block>
          </div>
        </div>
      </div>
    </div>

    <div class="body">
      <tal:maintenance replace="structure context/@@+maintenancemessage" />
      <tal:notifications define="notifications request/notifications"
                         condition="notifications">
        <metal:notifications
          use-macro="context/@@+main-template-macros/notifications" />
      </tal:notifications>

      <metal:block define-slot="body">
      </metal:block>
    </div>

    <div class="visualClear">&nbsp;</div>

    <metal:footer define-slot="footer" />

</body>
</html>
</metal:meta-master>
</tal:root>
