launchpad-buildd (46) dapper-cat; urgency=low

  * slave.py: Accept a separate username and password to the
    ensurePresent() call which, if present, are used to install
    an auth handler to cope with basic http auth with the http
    server when fetching files.
  * slave.py: Ensure that build logs are sanitized so that any
    user:password@ parts in URLs are removed.

 -- Julian Edwards <julian.edwards@canonical.com>  Tue, 29 Apr 2008 14:25:00 +0100

launchpad-buildd (45) dapper-cat; urgency=low

  * slave.py: Stop setting BuilderStatus.WAITING in each failure
    method, as this gives us a race where the builddmaster might
    dispatch another build to us before we're done cleaning up.
  * slave.py: Don't set BuildStatus.OK in buildComplete(), this is
    now a generic "the build has ended, succesfully or not" method.
  * slave.py: Define a new buildOK() method that sets BuildStatus.OK.
  * debian.py: When done cleaning, if the build isn't already marked
    as failed, call buildOK, then call buildComplete unconditionally.
  * The above changes should resolve https://launchpad.net/bugs/179466

 -- Adam Conrad <adconrad@ubuntu.com>  Tue, 08 Apr 2008 14:12:07 -0600

launchpad-buildd (44) dapper-cat; urgency=low

  * slave.py: Redefine "private" _unpackChroot() as "public" doUnpack(),
    so we can use it from the build iteration control process.
  * slave.py: Make the initiate method set a _chroottarfile private
    variable for use by doUnpack(), rather than calling _unpackChroot().
  * slave.py: Trigger the forked buildd process with an echo statement.
  * debian.py: Add the INIT state to the DebianBuildState class.
  * debian.py: Start the build process at INIT state instead of UNPACK.
  * debian.py: Add iterate_INIT(), which just checks success of the
    initial variable sanitisation checks, then hands off to doUnpack().
  * debian.py: Adjust the failure return calls of the UNPACK and MOUNT
    methods to chrootFail() instead of builderFail(), for correctness.
  * The above changes should resolve https://launchpad.net/bugs/211974

 -- Adam Conrad <adconrad@ubuntu.com>  Mon, 07 Apr 2008 13:53:20 -0600

launchpad-buildd (43) dapper-cat; urgency=low

  * unpack-chroot: Move the ntpdate calls below the bunzip/exec bit,
    so we don't run ntpdate twice when unzipping tarballs, which 
    happens on every single build on Xen hosts (like the PPA hosts).
  * debian/control: We use adduser in postinst, depending on it helps.
  * debian/control: Set myself as the Maintainer, since I'm in here.
  * debian/control: Change our section from "misc" to "admin".
  * sbuild{,-package}: Pass DEB_BUILD_OPTIONS="parallel=N" to dpkg.

 -- Adam Conrad <adconrad@ubuntu.com>  Thu, 24 Jan 2008 15:39:20 -0700

launchpad-buildd (42) dapper-cat; urgency=low

  * sbuild: using "eq" to evaluate strings instead of "==" is ever
    so slightly less retarded (fixed the launchpad bug #184565)

 -- Adam Conrad <adconrad@ubuntu.com>  Tue, 22 Jan 2008 16:21:54 -0700

launchpad-buildd (41) dapper-cat; urgency=low

  * sbuild: If we've already marked a package as "installed" with a
    valid version, don't overwrite that version with PROVIDED.

 -- Adam Conrad <adconrad@ubuntu.com>  Thu, 17 Jan 2008 10:39:26 -0700

launchpad-buildd (40) dapper-cat; urgency=low

  * sbuild: Don't allow versioned build-deps to be satisfied by provided
    packages, but force them to go through the "upgrade/downgrade" tests.
  * sbuild: Do --info and --contents on _all.deb packages as well, if
    we're building arch:all packages.
  * sbuild: Don't process ENV_OVERRIDE anymore, we only had an override
    for one thing anyway (LC_ALL), and this code caused bug #87077.
  * sbuild-package: Call sbuild with LC_ALL=C explicitely, to compensate.
  * Makefile: clean up the makefile a bit to DTRT (as I expect it).

 -- Adam Conrad <adconrad@ubuntu.com>  Tue, 15 Jan 2008 16:51:08 -0700

launchpad-buildd (39) unstable; urgency=low

  * If we're fed an archive_purpose argument from the builddmaster,
    we pass --purpose=$archive_purpose to sbuild, and if we get suite
    from the builddmaster, we pass --dist=$suite to sbuild.
  * Mangle sbuild to write out Suite: and Purpose: stanzas to our
    CurrentlyBuilding file, according to command-line input.
  * Now that we're no longer always feeding -dautobuild to sbuild,
    fix up sbuild to always look for the chroot at chroot-autobuild
    instead of the Debian Way of using chroot-$suite.
  * If the config file contains an ntphost stanza, use that with
    ntpdate to sync the system's clock before we unpack the chroot.
  * Mangle update-config to add an ntphost stanza to the default
    config, and to 's/-dautobuild //' from the sbuild arguments.

 -- Adam Conrad <adconrad@ubuntu.com>  Thu, 20 Dec 2007 01:51:49 -0700

launchpad-buildd (38) unstable; urgency=high

  * unpack-chroot: set $PATH rather than hardcoding paths to binaries
    since bzip2 moved from /usr/bin to /bin in edgy and didn't bother with
    compatability symlinks.

 -- James Troup <james.troup@canonical.com>  Wed, 21 Nov 2007 17:08:36 +0000

launchpad-buildd (37) dapper; urgency=high

  * update-debian-chroot: Adam's LPIA support (i.e. overriding
    architecture for chapt-get).
  * debian/launchpad-buildd.cron.daily: fix run-on-line.
  * debian/postinst: only create ~buildd/.sbuildrc if it doesn't exist.
    This avoids the problem of upgrades of the launchpad-buildd package
    resetting the architecture to i386 on lpia builders.

 -- James Troup <james.troup@canonical.com>  Wed, 14 Nov 2007 18:34:46 +0000

launchpad-buildd (36) dapper; urgency=low

  * changing override-sources to replace current sources.list with
    the content sent by buildmaster instead of prepend. It will allow
    us to cope more easily with SoyuzArchive implementation (PARTNER,
    EMBARGOED, PPA)

 -- Celso Providelo <cprov@canonical.com>  Thu, 7 Aug 2007 14:10:26 -0300

launchpad-buildd (35) unstable; urgency=low

  * including previous code changes (32 & 33).

 -- Celso Providelo <cprov@canonical.com>  Thu, 23 May 2007 17:40:26 -0300

launchpad-buildd (34) unstable; urgency=low

  * add suport for overriding the chroot /etc/apt/sources.list with the
    content of builddmaster build arguments 'archives'.

 -- Celso Providelo <cprov@canonical.com>  Thu, 17 May 2007 15:12:26 -0300

launchpad-buildd (33) unstable; urgency=low

  * Mangle sbuild further to allow us to publish Martin's debug debs (ddeb)
    to public_html/ddebs/ until such a time as soyuz can do this natively.
  * Fix the auto-dep-wait regexes to allow for versions with ~ in them.
  * Make cron.daily clean out translations and ddebs more than 1 week old.

 -- Adam Conrad <adconrad@ubuntu.com>  Sat, 30 Sep 2006 17:25:25 +1000

launchpad-buildd (32) unstable; urgency=low

  * We need to create /var/run/launchpad-buildd in our init script in the
    case (such as in current dapper) where /var/run is on a tmpfs.
  * Our init script shouldn't exit non-zero on "stop" if already stopped.
  * Remove exc_info argument from our call to self.log in slave.py, which
    clearly doesn't support that argument, so stop producing tracebacks.
  * Reset self.builddependencies in our clean routine, so the variable
    doesn't get leaked to the next build, causing me SERIOUS confusion.
  * Tidy up translation handling a bit more to deal with old chroots (where
    pkgstriptranslations won't dpkg-distaddfile for us), and to chmod the
    translation dirs after the build, so apache can actually get at them.
  * Add --no_save to our command line to avoid useless -shutdown.tap files.
  * Make sure umount-chroot doesn't fail, even if there's nothing to umount.
  * Append to the cron.daily cleaning to also occasionally clean up the apt
    cache and /home/buildd/filecache-default, so we don't run out of disk.

 -- Adam Conrad <adconrad@ubuntu.com>  Fri, 17 Mar 2006 19:39:05 +1100

launchpad-buildd (31) unstable; urgency=low

  * Cherry-pick patch from Ryan's sbuild that outputs dpkg --purge output
    line-by-line, instead of as one big blob, to make output on the web
    UI a little bit more friendly for people following along at home.
  * Install a cron.daily script (eww) to purge old build logs for now until
    I have the time to learn how twisted's native log rotation works.

 -- Adam Conrad <adconrad@ubuntu.com>  Wed, 15 Mar 2006 17:23:26 +1100

launchpad-buildd (30) unstable; urgency=low

  * Move our translation publishing mojo so it happens BEFORE we move
    all the files from debian/files out of the chroot, instead of after.

 -- Adam Conrad <adconrad@ubuntu.com>  Wed,  8 Mar 2006 18:50:49 +1100

launchpad-buildd (29) unstable; urgency=low

  * Use dpkg --print-installation-architecture in our postinst instead
    of --print-architecture to avoid spewing suprious error messages.
  * Remove the check for log_dir, since we call sbuild with --nolog,
    and stop creating $HOME/logs in the user setup part of postinst.

 -- Adam Conrad <adconrad@ubuntu.com>  Tue,  7 Mar 2006 19:13:56 +1100

launchpad-buildd (28) unstable; urgency=low

  * Modify the protocol method ensurepresent to return additional
    information about the target files lookup procedure. It helps to
    debug intermittent Librarian errors.

 -- Celso Providelo <celso.providelo@canonical.com>  Mon, 06 Mar 2006 16:42:00 -0300

launchpad-buildd (27) unstable; urgency=low

  * Update the slave chroot tool to use getent so it works on the production
    buildds

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Mon, 20 Feb 2006 12:57:45 +0000

launchpad-buildd (26) unstable; urgency=low

  * Update buildd-slave code to allow for GIVENBACK status returns,
    matching the states under which sbuild used to do --auto-give-back.
  * Port over sanae's build log regex parsing to allow us to do:
    - Automatic dep-wait handling, based on sbuild's logs of apt-get.
    - Automatic give-backs for a few corner cases (like kernel bugs).
  * Make sbuild stop dying if we have no sendmail installed, since we
    don't really want it sending mail in the launchpad world anyway.
  * Call sbuild and apt with "LANG=C", so we don't have to worry about
    locales matching between the base system and the autobuild chroots.
  * Clear up confusion in build states with 's/BUILDFAIL/PACKAGEFAIL/'

 -- Adam Conrad <adconrad@ubuntu.com>  Mon, 27 Feb 2006 14:00:08 +1100

launchpad-buildd (25) unstable; urgency=low

  * Update sbuild.conf to current yumminess.

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Fri,  3 Feb 2006 19:22:01 +0000

launchpad-buildd (24) unstable; urgency=low

  * Add /var/cache/apt/archives to the buildd chroots when mounting

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Fri,  3 Feb 2006 00:30:07 +0000

launchpad-buildd (23) unstable; urgency=low

  * And make apply-ogre-model use $SUDO, yay

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Fri, 27 Jan 2006 13:59:10 +0000

launchpad-buildd (22) unstable; urgency=low

  * Fix typo in apply-ogre-model (missing space)

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Fri, 27 Jan 2006 13:55:12 +0000

launchpad-buildd (21) unstable; urgency=low

  * Fix the .extend call for the --comp argument to pass it as one argument
    instead of as - - c o m p = m a i n (which kinda doesn't work)

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Fri, 27 Jan 2006 13:45:34 +0000

launchpad-buildd (20) unstable; urgency=low

  * Update sbuild to the latest sbuild from adam.
  * Make sure we pass --archive=ubuntu
  * Make sure we pass --comp=<the component we're building for>

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Thu, 26 Jan 2006 17:20:49 +0000

launchpad-buildd (19) unstable; urgency=low

  * Add ogre support to the slave chroot tool
  * Make sure the chroot tool ensures localhost in /etc/hosts in the chroot

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Wed, 25 Jan 2006 12:29:04 +0000

launchpad-buildd (18) unstable; urgency=low

  * Remove sbuildrc.tmp dangleberry in postinst
  * Add linux32 to set of depends so that hppa, sparc and powerpc can build
  * Make hppa, sparc, powerpc use linux32 to invoke the sbuild binary
  * Add --resolve-deps to debootstrap invocation
  * Make chroot tool use /bin/su - rather than /bin/sh for chrooting. shiny
    (apparently)
  * Add a bunch of deps infinity spotted.
  * Make sure we chown the chroot tarball to the calling user after packing
    it up.

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Wed,  9 Nov 2005 17:37:37 -0500

launchpad-buildd (17) unstable; urgency=low

  * Changed default UID/GID to match the ldap buildd UID/GID

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Wed,  9 Nov 2005 17:13:22 -0500

launchpad-buildd (16) unstable; urgency=low

  * Change the XMLRPC method 'ensure' to be 'ensurepresent'

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Wed,  5 Oct 2005 15:50:58 +0100

launchpad-buildd (15) unstable; urgency=low

  * Fix it so getting a logtail when less than 2k is available will work.
  * Actually install apply-ogre-model
  * Also spot arch_indep properly

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Mon,  3 Oct 2005 14:34:55 +0100

launchpad-buildd (14) unstable; urgency=low

  * Slight bug in slave.py meant missing .emptyLog() attribute. Fixed.

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Mon,  3 Oct 2005 14:21:16 +0100

launchpad-buildd (13) unstable; urgency=low

  * Fix a syntax error in the postinst
  * Oh, and actually include the buildd config upgrader

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Mon,  3 Oct 2005 12:17:50 +0100

launchpad-buildd (12) unstable; urgency=low

  * Implement V1.0new protocol.
  * Add in OGRE support
  * Add in archindep support
  * If upgrading from < v12, will remove -A from sbuildargs and add in
    a default ogrepath to any buildd configs found in /etc/launchpad-buildd
  * Prevent launchpad-buildd init from starting ~ files
  
 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Sun,  2 Oct 2005 23:20:08 +0100

launchpad-buildd (11) unstable; urgency=low

  * Quieten down the slave scripts and make them prettier for the logs.
  * make unpack-chroot uncompress the chroot and keep it uncompressed if
    possible. This fixes bug#2699
  * Make the slave run the process reaper run even if the build failed.

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Fri, 30 Sep 2005 00:24:45 +0100

launchpad-buildd (10) unstable; urgency=low

  * Make sure /etc/source-dependencies is present in the postinst.
    (just need to be touched)

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Wed, 28 Sep 2005 22:02:26 +0100

launchpad-buildd (9) unstable; urgency=low

  * Implement /filecache/XXX urls in the slave to permit larger file transfer

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Tue, 27 Sep 2005 13:16:52 +0100

launchpad-buildd (8) unstable; urgency=low

  * spiv's crappy spawnFDs implementation needs an int not a file handle
    and can't cope with converting one to the other :-(

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Tue, 27 Sep 2005 02:18:05 +0100

launchpad-buildd (7) unstable; urgency=low

  * Made sure the slave puts /dev/null on the subprocess stdin.

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Tue, 27 Sep 2005 01:52:50 +0100

launchpad-buildd (6) unstable; urgency=low

  * Removed slavechroot.py from installed set.

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Thu, 15 Sep 2005 11:39:25 +0100

launchpad-buildd (5) unstable; urgency=low

  * Add slave tool and example chroot configuration
  * Added debootstrap and dpkg-dev to the dependencies

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Fri,  9 Sep 2005 16:38:22 +0100

launchpad-buildd (4) unstable; urgency=low

  * Add sbuild.conf which was previously missing
  * Fix up abort protocol and various other bits in the slave

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Fri,  9 Sep 2005 14:24:31 +0100

launchpad-buildd (3) unstable; urgency=low

  * Modified postinst to make sure ccache and log dirs are created
    even if the user already exists.

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Wed,  7 Sep 2005 15:50:36 +0100

launchpad-buildd (2) unstable; urgency=low

  * Fixes to postinst to make sure ccache and log dirs are created if missing.
  * Added README to explain how to build the package.

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Thu,  1 Sep 2005 10:46:08 +0100

launchpad-buildd (1) unstable; urgency=low

  * Initial version

 -- Daniel Silverstone <daniel.silverstone@canonical.com>  Mon, 13 Jun 2005 11:08:38 +0100

