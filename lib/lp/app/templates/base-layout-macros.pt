<macros
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="launchpad"
  tal:omit-tag=""
>

<metal:notifications define-macro="notifications"
  tal:define="notifications notifications|request/notifications">
  <tal:comment replace="nothing">
    This macro expects the following variables:
    :notifications: An object implementing INotificationList.
  </tal:comment>

  <div class="error message"
    tal:repeat="notification notifications/error"
    tal:content="structure notification/message"
  >An error notification message</div>
  <div class="warning message"
    tal:repeat="notification notifications/warning"
    tal:content="structure notification/message"
  >A warning notification message</div>
  <div class="informational message"
    tal:repeat="notification notifications/notice"
    tal:content="structure notification/message"
  >A notice notification message</div>
  <div class="informational message"
    tal:repeat="notification notifications/info"
    tal:content="structure notification/message"
  >An info notification message</div>
  <div class="debug message"
    tal:repeat="notification notifications/debug"
    tal:content="structure notification/message"
  >A debug notification message, only displayed for developers.</div>
</metal:notifications>


<metal:load-javascript define-macro="load-javascript"
  tal:define="
      revno modules/canonical.launchpad.versioninfo/revno | string:unknown;
      rooturl modules/canonical.launchpad.webapp.vhosts/allvhosts/configs/mainsite/rooturl;
      icingroot string:${rooturl}+icing/rev${revno};
      devmode modules/canonical.config/config/devmode;
      yui string:${icingroot}/yui;
      lazr_js string:${icingroot}/lazr/build;
      lp_js string:${icingroot}/build"
  >
  <tal:comment replace="nothing">
    This macro just loads javascript files. It doesn't
    do any initialization.
  </tal:comment>

  <tal:devmode condition="devmode">

    <tal:comment replace="nothing">
      Instead of loading the yui.js seed we will load three of it's five
      sub-components.

      We leave out get.js and loader.js, effectively disabling
      dynamic loading of modules.

      XXX mars 2009-11-03
      To see what modules are missing you have to change yui-base.js to
      yui-base-debug.js and move the <script/> node outside of this block.

      This will hopefully be fixed in YUI itself.
      See http://yuilibrary.com/projects/yui3/ticket/2528368
    </tal:comment>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/yui/yui-base.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/yui/yui-log.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/yui/yui-later.js"></script>

    <script type="text/javascript"
            tal:attributes="src string:${yui}/oop/oop.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/event/event.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/event/event-key.js"></script>            
    <script type="text/javascript"
            tal:attributes="src string:${yui}/event-custom/event-custom.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/event-simulate/event-simulate.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/dom/dom.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/node/node.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/node-focusmanager/node-focusmanager.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/node/node-event-simulate.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/dump/dump.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/io/io.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/json/json.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/attribute/attribute.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/base/base.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/substitute/substitute.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/anim/anim.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/classnamemanager/classnamemanager.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/plugin/plugin.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/pluginhost/pluginhost.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-position-ext.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/cookie/cookie.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-position.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-position-ext.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-stack.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-stdmod.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/overlay/overlay.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/node-menunav/node-menunav.js"></script>

    <script type="text/javascript"
            tal:attributes="src string:${icingroot}/MochiKit.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/lazr/lazr.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/anim/anim.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/inlineedit/editor.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/autocomplete/autocomplete.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/overlay/overlay.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/activator/activator.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/picker/picker.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/formoverlay/formoverlay.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/choiceedit/choiceedit.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/effects/effects.js"></script>

    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/lp.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/dragscroll.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/picker.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/mapping.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/registry/milestoneoverlay.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/registry/timeline.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/sorttable/sorttable.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/inlinehelp/inlinehelp.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/client/client.js"></script>

    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/code/branchmergeproposal.js">
    </script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/code/codereview.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/comment.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/errors.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/registry/team.js"></script>

  </tal:devmode>
  <tal:production condition="not:devmode">
    <script type="text/javascript"
            tal:attributes="src string:${icingroot}/build/launchpad.js"></script>
  </tal:production>

  <script type="text/javascript"
      tal:content="string:var cookie_scope = '${request/lp:cookie_scope}';"></script>
  <script type="text/javascript">
    // Define a global YUI sandbox that should be used by everyone.
    var LPS = YUI();
  </script>
</metal:load-javascript>


<metal:page-javascript define-macro="page-javascript"
  tal:define="
      revno modules/canonical.launchpad.versioninfo/revno | string:unknown;
      rooturl modules/canonical.launchpad.webapp.vhosts/allvhosts/configs/mainsite/rooturl;
      icingroot_contrib string:${rooturl}+icing-contrib/rev${revno};
      devmode modules/canonical.config/config/devmode;
      map_query string:&amp;file=api&amp;v=2&amp;key=${modules/canonical.config/config/google/maps_api_key};">
  <tal:comment replace="nothing">
    Load and initialize the common script used by all pages.
  </tal:comment>

  <tal:needs_json tal:condition="request/needs_json">
    <script type="text/javascript"
            tal:attributes="src string:${icingroot_contrib}/json2.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${icingroot_contrib}/JSONScriptRequest.js"></script>
  </tal:needs_json>
  <tal:needs-gmap2 condition="request/needs_gmap2">
    <script type="text/javascript"
            tal:condition="devmode"
            tal:attributes="src string:http://maps.google.com/maps?${map_query};"></script>
    <script type="text/javascript"
            tal:condition="not: devmode"
            tal:attributes="src string:https://maps-api-ssl.google.com/maps?oe=utf-8&amp;client=gme-canonical${map_query};"></script>
  </tal:needs-gmap2>

  <metal:load-lavascript use-macro="context/@@+base-layout-macros/load-javascript" />

  <script type="text/javascript">
    LPS.use('node', 'lp', function(Y) {
        Y.on('load', function(e) {
            sortables_init();
            initInlineHelp();
            Y.lp.activate_collapsibles();
            activateFoldables();
            activateConstrainBugExpiration();
        }, window);

        // Hook up the function that dismisses the help window if we click
        // anywhere outside of it.
        Y.on('click', handleClickOnPage, window);
    });
  </script>
</metal:page-javascript>


<metal:launchpad-stylesheet-3-0 define-macro="launchpad-stylesheet-3-0"
  tal:define="
    revno modules/canonical.launchpad.versioninfo/revno | string:unknown;
    rooturl modules/canonical.launchpad.webapp.vhosts/allvhosts/configs/mainsite/rooturl;
    icingroot string:${rooturl}+icing/rev${revno}">
  <tal:comment replace="nothing">
    This macro loads a single css file containing all our stylesheets.
    If you need to include a new css file here, add it to
    buildout-templates/bin/combine-css.in instead.
  </tal:comment>
  <style type="text/css" media="screen, print"
    tal:content="string:@import url(${icingroot}/combo.css);"/>
</metal:launchpad-stylesheet-3-0>


<metal:lp-client-cache define-macro="lp-client-cache">
  <tal:cache condition="view/user|nothing"
              define="cache request/webservicerequest:cache;
                      links cache/links;
                      objects cache/objects;">
    <script tal:repeat="key links"
      tal:content="string:LP.client.links['${key}'] =
                   '${links/?key/fmt:api_url}';">
    </script>
    <script tal:repeat="key objects"
      tal:content="string:LP.client.cache['${key}'] =
                   ${objects/?key/webservice:json};">
    </script>
  </tal:cache>

  <script tal:condition="context/webservice:is_entry"
    tal:content="string:LP.client.cache['context'] =
                 ${context/webservice:json};">
  </script>
</metal:lp-client-cache>


<metal:application-buttons define-macro="application-buttons">
  <!-- Application Menu -->
  <ul class="facetmenu"
      tal:define="facetmenu view/menu:facet">
    <tal:facet repeat="link facetmenu">
      <li
        tal:condition="python: link.enabled and link.selected"
        tal:attributes="title link/summary; class string:${link/name} active"
        ><span
          tal:condition="not:link/linked"
          tal:content="structure link/escapedtext"
          /><a
          tal:condition="link/linked"
          tal:attributes="href link/url"
          tal:content="structure link/escapedtext" /></li>
      <li
        tal:condition="python: link.enabled and not link.selected"
        tal:attributes="title link/summary; class link/name"
        ><a
          tal:condition="link/enabled"
          tal:attributes="href link/url"
          tal:content="structure link/escapedtext"
          /></li>
      <li
        tal:condition="not:link/enabled"
        tal:attributes="class string:${link/name} disabled-tab"
        ><span
           tal:content="link/escapedtext" /></li>
    </tal:facet>
  </ul>
</metal:application-buttons>


<metal:footer define-macro="footer">
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a tal:attributes="href string:${rooturl}"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad"/></a>
          &nbsp;&bull;&nbsp;
          <a href="/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8"
            class="sprite-after search-icon"
            tal:condition="view/macro:pagehas/globalsearch"
            tal:attributes="action string:${rooturl}+search">
            <input type="search" id="search-text" name="field.text" />
          </form>
        </div>
        <metal:site-message
          use-macro="context/@@+base-layout-macros/site-message"/>
    </div>

    <div class="colophon">
      &copy; 2004-2010
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://help.launchpad.net/Feedback"
        >Contact us</a>
      &nbsp;&bull;&nbsp;
      <a href="http://identi.ca/launchpadstatus"
        >System status</a>
      <span id="lp-version" tal:condition="not:is_lpnet">
      &nbsp;&bull;&nbsp;
        <a href="https://help.launchpad.net/LaunchpadReleases"
          tal:content="version"/>
        <tal:devmode condition="devmode">devmode</tal:devmode>
        <tal:demo condition="is_demo">demo site</tal:demo>
        <tal:edge condition="is_edge">beta site</tal:edge>
      </span>
    </div>
  </div>
</metal:footer>

<metal:site-message define-macro="site-message">
  <div class="sitemessage" tal:condition="site_message">
    <tal:site_message tal:content="structure site_message">
      This site is running pre-release code.
    </tal:site_message>
    <tal:edge_only condition="is_edge">
      <tal:beta_user condition="view/macro:isbetauser">
        <a href="#" class="js-action" onclick="setBetaRedirect(false)"
           tal:condition="not:view/isRedirectInhibited">
          Disable edge redirect.
        </a>
        <a href="#" class="js-action" onclick="setBetaRedirect(true)"
           tal:condition="view/isRedirectInhibited">
          Enable edge redirect.
        </a>
      </tal:beta_user>
    </tal:edge_only>
  </div>
</metal:site-message>

</macros>
