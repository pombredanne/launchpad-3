Project group overview page
===========================

    # Add some milestones to products to verify the member project listing.
    >>> from zope.component import getUtility
    >>> from lp.registry.interfaces.product import IProductSet

    >>> login('test@canonical.com')
    >>> productset = getUtility(IProductSet)
    >>> gnome_terminal = productset.getByName('gnome-terminal')
    >>> milestone = factory.makeMilestone(name='2.30.0', product=gnome_terminal)
    >>> gnomebaker = productset.getByName('gnomebaker')
    >>> milestone = factory.makeMilestone(name='2.30.1', product=gnomebaker)
    >>> milestone = factory.makeMilestone(
    ...     name='2.1.7', productseries=gnomebaker.development_focus)
    >>> release = factory.makeProductRelease(milestone=milestone)
    >>> transaction.commit()
    >>> logout()

The overview page for project groups is accessible to all users.

    >>> anon_browser.open('http://launchpad.dev/gnome')
    >>> anon_browser.title
    'The GNOME Project in Launchpad'

The page lists the member projects.

    >>> print extract_text(find_tag_by_id(anon_browser.contents, 'products'))
    Projects
    Gnome Applets ...
    Evolution ...
      Releases: 2.1.6
    GNOME Terminal ...
      Milestones: 2.30.0
    gnomebaker ...
      Releases: 2.1.7
      Milestones: 2.30.1, 2.1.7
    NetApplet ...
      Releases: 1.0

And the projects, milestone, and releases are linked.

    >>> print anon_browser.getLink('gnomebaker').url
    http://launchpad.dev/gnomebaker

    >>> print anon_browser.getLink('2.30.1').url
    http://launchpad.dev/gnomebaker/+milestone/2.30.1

    >>> print anon_browser.getLink('2.1.7').url
    http://launchpad.dev/gnomebaker/trunk/2.1.7

The project overview page contains a link to register new products with the
project. It is only available to users which have 'Admin' privileges on the
project.

    >>> browser.open('http://launchpad.dev/mozilla')
    >>> browser.getLink('Register another project')
    Traceback (most recent call last):
      ...
    LinkNotFoundError...

    >>> browser.addHeader('Authorization', 'Basic no-priv@canonical.com:test')
    >>> browser.getLink('Register another project')
    Traceback (most recent call last):
      ...
    LinkNotFoundError...

    >>> admin_browser.open('http://launchpad.dev/mozilla')
    >>> admin_browser.getLink('Register another project').url
    'http://launchpad.dev/mozilla/+newproduct'

Also, it has a link to help translate it.

    >>> admin_browser.getLink('Help translate').click()
    >>> print admin_browser.title
    Translatable projects for The Mozilla Project


== Empty Project Groups ==

An empty project group needs to be set up first...

    >>> admin_browser.open('http://launchpad.dev/projectgroups/+new')
    >>> admin_browser.getControl(name='field.name').value = 'a-test-group'
    >>> admin_browser.getControl('Display Name:').value = 'Test Group'
    >>> admin_browser.getControl('Title:').value = 'My Test Group'
    >>> admin_browser.getControl(name='field.summary').value = 'Summary'
    >>> admin_browser.getControl('Description:').value = 'Define me'
    >>> admin_browser.getControl('Maintainer:').value = 'cprov'
    >>> admin_browser.getControl('Add').click()
    >>> admin_browser.url
    'http://launchpad.dev/a-test-group'

Empty project group index pages will not display the 'Report a bug', 'Ask a
question' or 'Help translate' buttons.

    >>> user_browser.open('http://launchpad.dev/a-test-group')
    >>> user_browser.getLink('Report a bug')
    Traceback (most recent call last):
      ..
    LinkNotFoundError...
    >>> user_browser.getLink('Ask a question')
    Traceback (most recent call last):
      ..
    LinkNotFoundError...
    >>> user_browser.getLink('Help translate')
    Traceback (most recent call last):
      ..
    LinkNotFoundError...
    >>> user_browser.getLink(url='+mentoring')
    Traceback (most recent call last):
      ..
    LinkNotFoundError...

Also, the bugs, blueprints, translations and answers facets will be disabled:

    >>> user_browser.open('http://launchpad.dev/a-test-group')
    >>> user_browser.getLink('Bugs')
    Traceback (most recent call last):
      ..
    LinkNotFoundError...
    >>> user_browser.getLink('Blueprints')
    Traceback (most recent call last):
      ..
    LinkNotFoundError...
    >>> user_browser.getLink('Answers')
    Traceback (most recent call last):
      ..
    LinkNotFoundError...
    >>> user_browser.getLink('Answers')
    Traceback (most recent call last):
      ..
    LinkNotFoundError...
    >>> user_browser.getLink('Translations')
    Traceback (most recent call last):
      ..
    LinkNotFoundError...

A warning message will be displayed at the top of the overview page when the
owner of the project group views it:

    >>> admin_browser.open('http://launchpad.dev/a-test-group')
    >>> for warning in find_tags_by_class(admin_browser.contents, 'warning'):
    ...     extract_text(warning.renderContents())
    u'There are no projects registered for\nTest Group...'

A link is included in the warning message which will take the admin user to
the new product form for the project group.

    >>> admin_browser.getLink(
    ...     'register another project that is part of Test Group').click()
    >>> admin_browser.title
    'Register a project in your project group'

== Products of a project ==

The home page of a project contains a list of all products which are part of that project.

    >>> browser.open('http://launchpad.dev/mozilla')
    >>> products = find_tags_by_class(browser.contents, 'project')
    >>> for product in products:
    ...     print repr(product.find('a').find(text=True))
    u'Mozilla Firefox'
    u'Mozilla Thunderbird'

Inactive products are not included in that list, though.

    # Use the DB classes directly to avoid having to setup a zope interaction
    # (i.e. login()) and bypass the security proxy.
    >>> from canonical.launchpad.database import Product
    >>> firefox = Product.byName('firefox')
    >>> firefox.active = False
    >>> firefox.syncUpdate()

    >>> browser.open('http://launchpad.dev/mozilla')
    >>> products = find_tags_by_class(browser.contents, 'project')
    >>> for product in products:
    ...     print repr(product.find('a').find(text=True))
    u'Mozilla Thunderbird'

    >>> firefox.active = True
    >>> firefox.syncUpdate()

== URL Shortut to Access the Project's Products ==

It is possible to access the project's product through the project URL.

# XXX flacoste 2007-02-14:
# Explain where this is used and why it is needed.

  >>> browser.open('http://launchpad.dev/mozilla/firefox')
  >>> browser.title
  'Mozilla Firefox in Launchpad'
  >>> print extract_text(find_main_content(browser.contents))
  Details
  ...Mozilla Firefox
  ...Part of: the Mozilla Project...

== Project bug subscriptions ==

To receive email notifications about bugs pertaining to a project, we
can create structural bug subscriptions.

    >>> user_browser.open('http://launchpad.dev/mozilla')
    >>> user_browser.getLink('Subscribe to bug mail').click()
    >>> print user_browser.url
    http://launchpad.dev/mozilla/+subscribe
    >>> print user_browser.title
    Bug subscriptions for The Mozilla Project
