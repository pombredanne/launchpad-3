<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  omit-tag="">

<!-- contact-details macro. -->
<metal:macro define-macro="team-details">
  <div class="portlet"
       id="contact-details">
    <h2 tal:condition="context/is_team">Team details</h2>

    <dl id="contact-email">
      <dt>Email:</dt>

      <dd>
        <tal:not_logged_in
          condition="view/email_address_visibility/is_login_required">
          <a href="+login">Log in</a> for email information.
        </tal:not_logged_in>

        <tal:no_preferredemail
          condition="view/email_address_visibility/are_none_available">
          No contact email
        </tal:no_preferredemail>

        <tal:emails repeat="email view/visible_email_addresses">
          <div style="white-space: nowrap">
            <img src="/@@/mail" alt="mail" />
            <tal:email replace="email">foo2@bar.com</tal:email>
            <a tal:replace="structure overview_menu/editemail/fmt:icon"></a>
          </div>
        </tal:emails>
        <a tal:condition="not: view/visible_email_addresses"
           tal:replace="structure overview_menu/editemail/fmt:link"></a>
      </dd>
    </dl>

    <div class="two-column-list">
      <dl id="team-owner">
        <dt>Owner:</dt>
        <dd>
          <tal:owner replace="structure context/teamowner/fmt:link"/>
        </dd>
      </dl>

      <dl id="team-datecreated">
        <dt>Created on:</dt>
        <dd>
          <span id="created-date"
                tal:attributes="title context/datecreated/fmt:datetime"
                tal:content="context/datecreated/fmt:date" />
        </dd>
      </dl>

      <dl id="contact-languages">
        <dt>Languages:</dt>
        <dd>
          <tal:languages content="view/languages">English</tal:languages>
          <a tal:replace="structure overview_menu/editlanguages/fmt:icon" />
        </dd>
      </dl>
      <dl id="subscription-policy">
        <dt>Subscription policy:</dt>
        <dd
          tal:attributes="title context/subscriptionpolicy/description">
          <span tal:replace="context/subscriptionpolicy/title" />
          <a class="sprite maybe" href="/+help/team-subscription-policy.html"
            target="help">&nbsp;</a>
        </dd>
      </dl>

    </div>
  </div>
</metal:macro>

<!-- contact macro -->
<metal:macro define-macro="contact">
  <div class="portlet" id="contact-user"
    tal:condition="view/can_contact">
    <a href="+contactuser" class="sprite mail"
      tal:attributes="title view/contact_link_title"
      tal:content="view/specific_contact_text">Contact
        this person</a>
  </div>
</metal:macro>

<!-- subteam-of macro. -->
<metal:macro define-macro="subteam-of">
  <div class="portlet"
       id="subteam-of"
       tal:condition="view/can_show_subteam_portlet"
       >
    <h2>Subteam of</h2>

    <p tal:condition="not: context/super_teams">
      &#8220;<span tal:replace="context/displayname"/>&#8221;
      itself is not a member of any other team.
    </p>

    <tal:is-a-subteam condition="context/super_teams">
      <p>
        &#8220;<span tal:replace="context/displayname"/>&#8221;
        is a member of these teams:
      </p>
      <ul class="iconed">
        <li tal:repeat="team context/super_teams">
          <tal:block replace="structure team/fmt:link" />
        </li>
      </ul>
    </tal:is-a-subteam>

    <ul class="horizontal">
      <li
        tal:condition="context/super_teams"
        tal:replace="structure overview_menu/memberships/fmt:link" />
      <li
        tal:condition="context/open_membership_invitations"
        tal:replace="structure overview_menu/received_invitations/fmt:link" />
    </ul>
  </div>
</metal:macro>

<metal:macro define-macro="sourcepackagerelease-rows">

  <tal:comment replace="nothing">
    This macro expects the following variables defined:
    :sourcepackagereleases: A list of SourcePackageRelease objects
  </tal:comment>

  <tr tal:repeat="sourcepackagerelease sourcepackagereleases">
  <tal:define define="spr sourcepackagerelease;
                     distroseries spr/upload_distroseries">
    <td>
      <a tal:attributes="href string:${distroseries/distribution/fmt:url}/+source/${spr/name}"
         class="distrosrcpackage"
         tal:content="spr/sourcepackagename/name">
      </a>
    </td>
    <td>
      <a tal:attributes="href string:${distroseries/fmt:url}/+source/${spr/name}"
         class="distroseriessrcpackage"
         tal:content="distroseries/fullseriesname">
      </a>
    </td>
    <td>
      <a tal:attributes="href string:${distroseries/distribution/fmt:url}/+source/${spr/name}/${spr/version}"
         class="distrosrcpackagerelease"
         tal:content="spr/version">
      </a>
    </td>
    <td
      tal:attributes="title spr/dateuploaded/fmt:datetime"
      tal:content="spr/dateuploaded/fmt:approximatedate">
      2005-10-24
    </td>
    <td>
      <tal:needs_building condition="spr/needs_building">
          Not yet built
      </tal:needs_building>
      <tal:built condition="not: spr/needs_building">
          <tal:failed repeat="build spr/failed_builds">
             <a tal:attributes="href build/fmt:url"
                tal:content="build/distro_arch_series/architecturetag" />
          </tal:failed>
          <tal:not_failed condition="not: spr/failed_builds">
             None
          </tal:not_failed>
      </tal:built>
    </td>
    <td style="text-align: right">
      <a tal:attributes="href string:${spr/distrosourcepackage/fmt:url}/+bugs"
         tal:content="spr/open_bugs">
      </a>
    </td>
    <td style="text-align: right">
      <a tal:attributes="href string:${spr/distrosourcepackage/fmt:url}/+questions"
         tal:content="spr/open_questions">
      </a>
    </td>
  </tal:define>
  </tr>
</metal:macro>

<metal:macro define-macro="private-team-js">
  <tal:comment replace="nothing">
    This macro inserts the javascript necessary to automatically insert the
    private team prefix into a name field.  It is here since it is shared in
    multiple templates.
  </tal:comment>
  <tal:script define="private_prefix view/private_prefix|nothing"
              condition="private_prefix">
  <script type="text/javascript"
          tal:content="string:
    LPS.use('node', 'event', function(Y) {
      // Prepend/remove 'private-' from team name based on visibility
      // setting.  User can choose to edit it back out, if they wish.
      function visibility_on_change(e) {
        var visibility = e.target;
        var prefix = (visibility.get('value') == 'PRIVATE')
          ? '$private_prefix' : '';
        // XXX: Brad Crittenden 2009-01-30
        // bug=http://yuilibrary.com/projects/yui3/ticket/2423101
        // Dotted CSS selectors not parsed correctly.  Therefore not
        // using Y.one().
        var name = document.getElementById('field.name');
        name.value = prefix + name.value.replace(/^$private_prefix/, '');

      };
      // Attach the function to the onchange event.
      // XXX: Brad Crittenden 2009-01-30
      // bug=http://yuilibrary.com/projects/yui3/ticket/2423101
      // Dotted CSS selectors not parsed correctly.
      Y.on('change', visibility_on_change, document.getElementById('field.visibility'));
    });">
  </script>
  </tal:script>
</metal:macro>

</tal:root>
