<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
  i18n:domain="launchpad"
>
  <body>
    <div metal:fill-slot="main" class="pillar"
      tal:define="overview_menu context/menu:overview">
<tal:script
    replace="structure string:&lt;script type='text/javascript'&gt;" />
YUI().use('io-base', 'node', 'json-parse', function(Y) {

  function doUpdate(transaction_id, response, args) {
    json_values = Y.JSON.parse(response.responseText);
    if(json_values.commits && json_values.count > 0) {
      document.getElementById(args.container).innerHTML = '';
      sparkline(args.container, json_values);
    }
    else
    {
      //alert(json_values);
    }
  }

  function doFailure(transaction_id, response, args) {
    Y.log('Fail');
  }


  function updateSparks() {
      var container = "main_spark";
      var uri = "<tal:block replace="context/development_focus/branch/fmt:api_url"/>/+spark";
      var xhr_config = {
          on: {
              success: doUpdate,
              failure: doFailure,
          },
          arguments: {
              'container': container
          }
      };

      Y.io(uri, xhr_config);
  }


  function sparkline(branch_id, o) {
    var spark_div = document.getElementById(branch_id);
    var number_commits = parseInt(o.commits.length);
    var w = 160;
    var min = 9999;
    var max = -1;
    var h = 12;
    var co = document.createElement("canvas");

    if (co.getContext) {
      spark_div.style.display = 'inline';
    } else {
      return false;
    }

    co.style.height = h;
    co.style.width = w;
    co.width = w;
    co.height = h;

    spark_div.appendChild(co);

    // Figure out the max and min number of commits
    for (var i = 0; i < number_commits; i++) {
      o.commits[i] = o.commits[i] - 0;
      if ( o.commits[i] < min ) min = o.commits[i];
      if ( o.commits[i] > max ) max = o.commits[i];
    }

    if (co.getContext) {
      var c = co.getContext("2d");
      c.strokeStyle = "black";
      c.lineWidth = 1.0;
      c.beginPath();

      for (var i = 0; i < number_commits; i++) {
        x_pos = (w / number_commits) * i;
        y_pos = h - (((o.commits[i] - min) / (max - min)) * h);

        if (i == 0) {
          c.moveTo(x_pos, y_pos);
        }
        c.lineTo(x_pos, y_pos);

        // When was the last commit?
        if(o.commits[i] > 0) {
          last_commit = i+1;
        }

      }
      c.stroke();

      // Marks the point with the most commits
      c.fillStyle = 'red';
      c.beginPath();
      c.arc((w / number_commits) * o.max_commits,
            h+2 - (((o.commits[o.max_commits] - min) / (max - min)) * h),
            2, 0, (Math.PI*2), true);
      c.fill();

      new_text = document.createTextNode(o.commits[o.max_commits] + ' commits');
      new_div = document.createElement('div');
      new_div.setAttribute('id', 'txt_max_' + branch_id);
      new_div.appendChild(new_text);
      document.getElementById(branch_id).appendChild(new_div);
      new_div.style.fontSize = '8px';
      new_div.style.color = 'red';
      new_div.style.position = 'relative';
      new_div.style.top = '-22px';
      new_div.style.left = (((w / number_commits) * o.max_commits)-14) + 'px';


      c.fillStyle = 'blue';
      c.beginPath();
      c.arc((w / number_commits) * last_commit, h-2,
            2, 0, (Math.PI*2), true);
      c.fill();

      new_text = document.createTextNode(o.last_commit);
      new_div = document.createElement('div');
      new_div.setAttribute('id', 'txt_' + branch_id);
      new_div.appendChild(new_text);
      document.getElementById(branch_id).appendChild(new_div);
      new_div.style.fontSize = '8px';
      new_div.style.color = 'blue';
      new_div.style.position = 'relative';
      new_div.style.left = (((w / number_commits) * last_commit)-24) + 'px';
      new_div.style.top = '-10px';

      spark_div.style.display = 'inline';
    }
  }

  Y.on("domready", updateSparks);
});
<tal:script replace="structure string:&lt;/script&gt;" />
      <div class="section">
        <div style="float:right">
          <tal:review
            content="structure overview_menu/review_license/fmt:link-icon" />
          <tal:admin
            content="structure overview_menu/administer/fmt:link-icon" />
          <tal:edit
            content="structure overview_menu/edit/fmt:link-icon" />
        </div>
        <tal:mugshot replace="structure context/image:mugshot" />
        <h1 tal:replace="structure view/title_edit_widget">
          Name of project
        </h1>
        <p id="project-admin-whiteboard" class="whiteboard"
           tal:condition="context/required:launchpad.Commercial">
          <span tal:content="context/reviewer_whiteboard" />
          (<a href="+review-license">edit reviewer whiteboard</a>)
        </p>
        <p tal:condition="not: context/active"
           class="warning message"
           id="project-inactive" >
          This project is currently inactive
          <tal:comment condition="nothing">
            This page links to the +review-license form to reactivate
            the product since both the admins and commercial-admins
            have access to this form unlike the product/+admin form.
          </tal:comment>
          <a href="+review-license">(change this)</a>
        </p>

        <p id="license-status" tal:condition="view/show_license_status">
          <strong tal:content="structure context/license_status/description">
            This project's license is proprietary.
          </strong>
        </p>
      </div>
      <div class="description" tal:content="context/summary">
        $Product.summary goes here. This should be quite short,
        just a single paragraph of text really, giving the project
        highlights.
      </div>

      <div
         class="description"
         tal:content="structure context/description/fmt:text-to-html"
         tal:condition="context/description"
      >
        $Product.description goes here. This should be a longer piece of
        text, up to three paragraphs in length, which gives much more
        detailed information about the open source project in question.
      </div>

      <tal:has-external-links condition="view/has_external_links">
        <ul>
          <li class="external link" tal:condition="view/should_display_homepage">
            <a id="homepageurl-link" tal:attributes="href context/homepageurl">
              <strong>Home page</strong>
            </a>
          </li>
          <li class="external link" tal:condition="view/sourceforge_url">
            <a id="sourceforge-link" tal:attributes="href view/sourceforge_url">
              <strong>Sourceforge project</strong>
            </a>
          </li>
          <li class="external link" tal:condition="view/freshmeat_url">
            <a id="freshmeat-link" tal:attributes="href view/freshmeat_url">
              <strong>Freshmeat record</strong>
            </a>
          </li>
          <li class="external link" tal:condition="context/wikiurl">
            <a id="wikiurl-link" tal:attributes="href context/wikiurl">
              <strong>Wiki</strong>
            </a>
          </li>
          <li class="external link" tal:condition="context/screenshotsurl">
            <a id="screenshotsurl-link" tal:attributes="href context/screenshotsurl">
              <strong>Screenshots</strong>
            </a>
          </li>
          <li class="external link" tal:condition="context/downloadurl">
            <a id="downloadurl-link" tal:attributes="href context/downloadurl">
              <strong>External downloads</strong>
            </a>
          </li>
        </ul>
      </tal:has-external-links>

      <p id="partof" tal:condition="context/project">
        <strong>Part of:</strong> <tal:link replace="structure context/project/fmt:link" />
      </p>

      <p id="aliases" tal:condition="context/aliases">
        <strong>Also known as:</strong>
        <tal:aliases repeat="alias context/aliases">
          <tal:alias replace="alias">something</tal:alias
            ><tal:comma condition="not:repeat/alias/end">,</tal:comma>
        </tal:aliases>
      </p>

      <tal:launchpad_usage define="uses_launchpad view/uses_launchpad_for">
        <p id="uses">
          <tal:uses_launchpad condition="uses_launchpad">
            <strong>Uses Launchpad for: </strong>
            <tal:uses content="structure uses_launchpad" />.
          </tal:uses_launchpad>
          <tal:no_launchpad condition="not: uses_launchpad">
            <strong>Does not use Launchpad for development.</strong>
          </tal:no_launchpad>
        </p>
      </tal:launchpad_usage>

      <p id="product-languages" tal:condition="context/programminglang">
        <strong>Languages:</strong> <span tal:content="context/programminglang">Python</span>
      </p>

      <p id="owner" tal:condition="context/owner">
        <strong>Maintainer:</strong> <tal:link replace="structure context/owner/fmt:link" />
      </p>

      <p id="driver" tal:condition="view/effective_driver">
        <strong>Driver:</strong> <tal:link replace="structure view/effective_driver/fmt:link" />
      </p>

      <p id="driver" tal:condition="not: view/effective_driver">
        <strong>Driver:</strong> Not yet appointed
      </p>

      <div>
        <strong>Licenses:</strong>
        <tal:licenses repeat="license context/licenses">
          <tal:license replace="license/title">GPL</tal:license><tal:comma
              condition="not:repeat/license/end">,</tal:comma>
        </tal:licenses>
        <tal:none condition="not:context/licenses">None specified</tal:none>
        <tal:has_description condition="context/license_info">
          (<tal:description replace="context/license_info" />)
        </tal:has_description>
      </div>

      <tal:subscription_info
         condition="view/show_commercial_subscription_info"
      >
        <p id="commercial_subscription"
           tal:condition="context/commercial_subscription">
          <strong>Commercial subscription expires:</strong>
          <tal:expiry content="context/commercial_subscription/date_expires/fmt:date" />
        </p>
      </tal:subscription_info>

      <div class="actions">
        <a
           tal:define="link context/menu:bugs/filebug"
           tal:condition="context/official_malone"
           tal:attributes="href link/url"
        >
          <img
             tal:attributes="alt link/text"
             src="/+icing/but-sml-reportabug.gif"
          />
        </a>
        <a
           tal:define="link context/menu:translations/overview"
           tal:condition="context/official_rosetta"
           tal:attributes="href link/url"
         >
          <img
             tal:attributes="alt link/text"
             src="/+icing/but-sml-helptranslate.gif"
          />
        </a>
        <a
           tal:define="link context/menu:answers/new"
           tal:condition="context/official_answers"
           tal:attributes="href link/url"
        >
          <img
             tal:attributes="alt link/text"
             src="/+icing/but-sml-askaquestion.gif"
          />
        </a>
        <a
           tal:define="link overview_menu/mentorship"
           tal:condition="context/mentoring_offers/count"
           tal:attributes="href link/url"
        >
          <img
             tal:attributes="alt link/text"
             src="/+icing/but-sml-mentoring.gif"
          />
        </a>
      </div>

      <tal:warning-for-owner
        condition="view/show_commercial_subscription_info"
      >
        <div class="section"
             tal:content="structure context/@@+portlet-requires-subscription"
             tal:condition="view/requires_commercial_subscription"
        />
        <div class="section"
             tal:content="structure context/@@+portlet-license-missing"
             tal:condition="not: context/licenses"
        />
      </tal:warning-for-owner>

      <div
         tal:condition="context/coming_sprints"
         tal:content="structure context/@@+portlet-coming-sprints"
         class="section"
      />
      <div
         class="section"
         tal:content="structure context/@@+portlet-latestannouncements"
      />

      <div class="portlet">
        <h2>Series and milestones</h2>
        <p>A "release series" is major release that would typically have a number
      of "point releases" associated with it.</p>
        <div id="main_spark"/>
        <div class="project series"
             tal:repeat="series view/sorted_active_series_list">

          <div tal:define="is_focus series/is_development_focus"
               tal:attributes="
                               class python:is_focus and 'highlighted' or 'unhighlighted'">
            <metal:series use-macro="series/@@+macros/detailed_display" />
          </div>
        </div>
        <div
           class="actions"
           tal:content="structure overview_menu/series_add/render"
        />
        <a href="+series">Series history</a><br/>
        <a href="+milestones">Milestone history</a>
      </div>

      <tal:contrib replace="structure context/@@+portlet-top-contributors" />
      <tal:packages replace="structure context/@@+portlet-packages" />

      <div class="section">
        <h2>Registered</h2>
        <tal:created replace="context/datecreated/fmt:approximatedate" /> by
        <tal:registrant replace="structure context/registrant/fmt:link" />
        <p />
        <div tal:content="structure overview_menu/rdf/render" />
      </div>
    </div>
  </body>
</html>
