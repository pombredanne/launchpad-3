Bug subscription views
======================

Getting subscriber CSS IDs
--------------------------

It's possible to get a mapping of bug subscriber names to CSS IDs using
the +bug-portlet-subscribers-ids view.

    >>> from lp.bugs.interfaces.bug import IBugSet
    >>> bug_15 = getUtility(IBugSet).get(15)

    >>> subscriber_ids_view = create_initialized_view(
    ...     bug_15, '+bug-portlet-subscribers-ids')

The view's subscriber_ids_js property returns a JSON struct of the
person name to CSS ID mappings for the bug's subscribers.

    >>> print subscriber_ids_view.subscriber_ids_js
    {"name16": "subscriber-16"}

If bug 15 is marked as a duplicate of another bug, its subscribers will
be included in that bugs subscriber_ids_js mapping.

    >>> bug_13 = getUtility(IBugSet).get(13)
    >>> subscriber_ids_view = create_initialized_view(
    ...     bug_13, '+bug-portlet-subscribers-ids')

    >>> print subscriber_ids_view.subscriber_ids_js
    {"name12": "subscriber-12"}

    >>> login('foo.bar@canonical.com')
    >>> bug_15.markAsDuplicate(bug_13)
    >>> bug_13 = getUtility(IBugSet).get(13)

    >>> subscriber_ids_view = create_initialized_view(
    ...     bug_13, '+bug-portlet-subscribers-ids')

    >>> print subscriber_ids_view.subscriber_ids_js
    {"name12": "subscriber-12", "name16": "subscriber-16"}
