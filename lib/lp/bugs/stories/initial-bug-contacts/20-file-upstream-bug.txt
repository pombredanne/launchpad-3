(We will use the advanced filebug form in the examples below, to skip
searching for dupes.)

Filing a public bug on an upstream will subscribe the bug supervisor, as
well.

    >>> browser.addHeader("Authorization", "Basic mark@hbd.com:test")

    >>> browser.open("http://launchpad.dev/firefox/+filebug-advanced")

    >>> browser.getControl(name="field.title").value = "bug supervisor test"
    >>> browser.getControl(name="field.comment").value = "a public bug"
    >>> browser.getControl("Submit Bug Report").click()

    >>> bug_id = browser.url.split("/")[-1]
    >>> print browser.url.replace(bug_id, "BUG-ID")
    http://bugs.launchpad.dev/firefox/+bug/BUG-ID

Now sabdfl (because he's the bug reporter), guadamen (because they are
the product bug supervisor), and lifeless (because he is a subscriber to
mozilla) are subscribed to this bug:

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.interfaces import IBugSet
    >>> from canonical.launchpad.ftests import login, logout, ANONYMOUS

    >>> def subscriber_names(bug):
    ...     subscribers = (
    ...         bug.getDirectSubscribers() + bug.getIndirectSubscribers())
    ...     return sorted(subscriber.displayname for subscriber in subscribers)

    >>> login(ANONYMOUS)
    >>> bugset = getUtility(IBugSet)
    >>> subscriber_names(bugset.get(bug_id))
    [u'GuadaMen', u'Mark Shuttleworth', u'Robert Collins']
    >>> logout()

For a security bug, only the reporter and the registrant gets
subscribed, because Firefox does not have a security contact.

    >>> from canonical.launchpad.interfaces import IProductSet

    >>> login(ANONYMOUS)
    >>> firefox = getUtility(IProductSet).getByName("firefox")
    >>> firefox.security_contact is None
    True
    >>> logout()

    >>> browser.open("http://launchpad.dev/firefox/+filebug-advanced")

    >>> browser.getControl(name="field.title").value = "bug supervisor test"
    >>> browser.getControl(name="field.comment").value = "a PRIVATE bug"
    >>> browser.getControl(
    ...     "This bug is a security vulnerability").selected = True
    >>> browser.getControl("Submit Bug Report").click()

    >>> other_bug_id = browser.url.split("/")[-1]
    >>> print browser.url.replace(other_bug_id, "BUG-ID")
    http://bugs.launchpad.dev/firefox/+bug/BUG-ID

    >>> logout()
    >>> login("mark@hbd.com")

    >>> subscriber_names(bugset.get(other_bug_id))
    [u'Mark Shuttleworth', u'Sample Person']

    >>> logout()
