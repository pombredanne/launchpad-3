Nominate a bug to a distribution release
========================================

A bug can be nominated for a distribution release.

    >>> login('foo.bar@canonical.com')
    >>> nominater = factory.makePerson(name='denominater',
    ...     password='g00dpassword')
    >>> poseidon = factory.makeDistribution(name='poseidon',
    ...     bug_supervisor=nominater)
    >>> dsp = factory.makeDistributionSourcePackage(distribution=poseidon)
    >>> series = factory.makeDistroSeries(distribution=poseidon,
    ...     name='aqua')
    >>> series = factory.makeDistroSeries(distribution=poseidon,
    ...     name='hydro')
    >>> bug_task = factory.makeBugTask(target=dsp)
    >>> nominater_browser = setupBrowser(
    ...     auth='Basic %s:g00dpassword' %
    ...     nominater.preferredemail.email)
    >>> logout()
    >>> nominater_browser.open(
    ...     "http://launchpad.dev/poseidon/+source/%s/+bug/%s/+nominate" %
    ...     (dsp.name, bug_task.bug.id))

Before we continue, we'll set up a second browser instance, to simulate
the nominater accessing the site from another window. Working with the same
form in different browser windows or tabs can sometimes trigger edge case
errors, and we'll give an example of one shortly.

    >>> login('foo.bar@canonical.com')
    >>> nominater_other_browser = setupBrowser(
    ...     auth='Basic %s:g00dpassword' %
    ...     nominater.preferredemail.email)
    >>> logout()
    >>> nominater_other_browser.open(
    ...     "http://launchpad.dev/poseidon/+source/%s/+bug/%s/+nominate" %
    ...     (dsp.name, bug_task.bug.id))
    >>> nominater_browser.getControl("Aqua").selected = True
    >>> nominater_browser.getControl("Nominate").click()
    >>> for tag in find_tags_by_class(nominater_browser.contents, 'message'):
    ...     print tag
    <div...Added nominations for: Poseidon Aqua...

Now, if the nominater, having the form open in another browser window,
accidentally nominates the bug for Aqua a second time, an error is
raised.

    >>> nominater_other_browser.getControl("Aqua").selected = True
    >>> nominater_other_browser.getControl("Nominate").click()

    >>> for tag in find_tags_by_class(nominater_other_browser.contents,
    ...     'message'):
    ...     print tag.renderContents()
    There is 1 error.
    This bug has already been nominated for these series: Aqua

When a nomination is submitted by a privileged user, it is immediately
approved and targeted to the release.

    >>> admin_browser.open(
    ...     "http://launchpad.dev/poseidon/+source/%s/+bug/%s/+nominate" %
    ...     (dsp.name, bug_task.bug.id))

    >>> admin_browser.getControl("Hydro").selected = True
    >>> admin_browser.getControl("Nominate").click()

    >>> for tag in find_tags_by_class(admin_browser.contents, 'message'):
    ...     print tag
    <div...Targeted bug to: Poseidon Hydro...
