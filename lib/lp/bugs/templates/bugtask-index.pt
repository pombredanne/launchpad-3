<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_side"
>
  <body>
    <metal:block fill-slot="head_epilogue">
      <script type='text/javascript' tal:content="string:var yui_base='${yui}';" />
      <script type='text/javascript' id='available-official-tags-js'
              tal:content="view/available_official_tags_js" />
      <script type="text/javascript">
        LPS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers',
                  'lp.code.branchmergeproposal.diff', 'lp.comments.hide',
                  function(Y) {
            Y.lp.bugs.bugtask_index.setup_bugtask_index();
            Y.on('load', function(e) {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
            }, window);
            Y.on('domready', function() {
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                Y.lp.comments.hide.setup_hide_controls();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                });
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .bug-branch-summary dd { font-size: 85% }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    </metal:block>

    <metal:side fill-slot="side" tal:define="context_menu context/menu:context">
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a tal:attributes="href string:${context/target/fmt:url}/+filebug"
               class="sprite bugs">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div tal:replace="structure context/bug/@@+portlet-privacy" />
      <div tal:replace="structure context/bug/@@+portlet-actions" />
      <div tal:replace="structure context/bug/@@+portlet-duplicates" />
      <div tal:replace="structure context/bug/@@+portlet-subscription" />
      <div tal:replace="structure context/bug/@@+portlet-subscribers" />
      <div tal:replace="structure context/bug/@@+portlet-questions" />
      <div tal:replace="structure context/bug/@@+portlet-specs" />
      <div tal:replace="structure context/bug/@@+portlet-attachments" />
      <div tal:replace="structure context/bug/@@+portlet-watch" />
    </metal:side>

    <tal:registering metal:fill-slot="registering">
      Reported by
      <tal:reporter replace="structure context/bug/owner/fmt:link" />
      <span
        tal:attributes="title context/bug/datecreated/fmt:datetime"
        tal:content="context/bug/datecreated/fmt:displaydate" />
    </tal:registering>

    <metal:heading fill-slot="heading" tal:define="context_menu context/menu:context">
      <h1 tal:replace="structure view/bug_title_edit_widget">
        Bug title
      </h1>
    </metal:heading>

    <div metal:fill-slot="main" tal:define="context_menu context/menu:context">
      <div id="tags-autocomplete">
       <div id="tags-autocomplete-content"></div>
      </div>

      <p class="informational message"
         tal:condition="view/notices"
         tal:repeat="notice view/notices"
         tal:content="notice">
        Reported this bug as also occurring in upstream firefox
      </p>

      <p
         id="can-expire"
         tal:condition="python: context.bug.isExpirable(days_old=0)"
         >
        <tal:expiration_message replace="view/expiration_message" />
        (<a href="https://help.launchpad.net/BugExpiry">find out why</a>)
      </p>

      <p id="bug-is-question" class="informational message"
         tal:condition="context/bug/getQuestionCreatedFromBug"
         tal:define="question context/bug/getQuestionCreatedFromBug">
        This bug report was converted into a question:
        question #<tal:question-id replace="question/id" />:
        <a href=""
           tal:attributes="href question/fmt:url"
           tal:content="question/title">%s</a>.
        <tal:XXX condition="nothing">
          # XXX mpt 20080716 bug=249094: This should be an alert only when
          # you have just now converted the report into a question.
        </tal:XXX>
      </p>

      <div style="float: right;">
        <tal:heat replace="structure view/bug_heat_html" />
      </div>

      <div tal:replace="structure context/bug/@@+bugtasks-and-nominations-portal" />
      <div id="maincontentsub">
        <div><!-- id="nonportlets"> -->
        <div class="top-portlet">

      <div class="report">
        <tal:description
            define="global description context/bug/description/fmt:obfuscate-email/fmt:text-to-html" />

        <tal:widget replace="structure view/bug_description_html"/>

        <div style="margin:-20px 0 20px 5px" class="clearfix">
          <span tal:condition="view/wasDescriptionModified"
          >See <a href="comments/0">original description</a></span>
        </div>

          <div id="bug-tags"
               tal:attributes="class python: (context.bug.tags and
                                             'tags-show' or 'tags-hide')">
            Tags:
            <span id="tag-list">
              <a tal:repeat="tag view/official_tags"
                 tal:content="tag"
                 class="official-tag"
                 tal:attributes="href string:${context/target/fmt:url}/+bugs?field.tag=${tag}">tag</a>
              <a tal:repeat="tag view/unofficial_tags"
                 tal:content="tag"
                 class="unofficial-tag"
                 tal:attributes="href string:${context/target/fmt:url}/+bugs?field.tag=${tag}">tag</a>
            </span>
            <form id="tags-form" style="display: inline">
                <input type="text" id="tag-input" class="hidden" style="width: 35em;" />
                <img src="/@@/spinner" id="tags-edit-spinner" class="hidden"/>
                <a href="+edit" title="Edit tags" id="edit-tags-trigger" class="sprite edit"></a>
              <script type="text/javascript">
                  LPS.use('event', 'node', 'lp.bugs.bug_tags_entry', function(Y) {
                      // XXX intellectronica 2009-04-16 bug #362309:
                      // The load event fires very late on bug pages that take a
                      // long time to render, but we prefer to use it since the
                      // domready event isn't reliable in YUI3 yet. To make sure
                      // that user doesn't click the trigger and navigates to the
                      // non-JS form, we first disable the link. This is awful and
                      // must be fixed as soon as YUI3 is fixed.
                      if (LP.links['me'] !== undefined) {
                          Y.one('#edit-tags-trigger').on('click', function(e) {
                              e.halt();
                          });
                      }
                      Y.on('load',
                           function(e) {
                               Y.lp.bugs.bug_tags_entry.setup_tag_entry(
                                   available_official_tags);
                           },
                           window);
                  });
              </script>

              <button class="lazr-pos lazr-btn yui-ieditor-submit_button hidden"
                      id="edit-tags-ok"
                      type="button">Ok</button>
              <button class="lazr-neg lazr-btn yui-ieditor-cancel_button hidden"
                      id="edit-tags-cancel"
                      type="button">Cancel</button>
           </form>
           <a href="/+help/tag-help.html" target="help" class="sprite maybe">&nbsp;
             <span class="invisible-link">Tag help</span></a>
          </div>
          <div id="add-bug-tags"
               tal:attributes="class python: (not(context.bug.tags) and
                                             'tags-show' or 'tags-hide')">
            <a href="+edit" title="Add tags" id="add-tags-trigger" class="sprite add">
              Add tags
            </a>
            <a href="/+help/tag-help.html" target="help" class="sprite maybe">&nbsp;
             <span class="invisible-link">Tag help</span></a>
          </div>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container"
            style="float: left">
          <tal:branches
              define="linked_branches view/linked_branches"
              condition="linked_branches">

            <div id="bug-branches">
              <h2>Related branches</h2>

              <tal:bug-branches repeat="linked_branch linked_branches">
                <tal:bug-branch replace="structure linked_branch/@@+bug-branch" />
              </tal:bug-branches>
            </div>
          </tal:branches>
        </div><!-- bug-branch-container -->

        <div tal:condition="context/bug/has_cves" class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve" tal:repeat="cve context/bug/cves">
              <a tal:attributes="href cve/fmt:url;
                                 title cve/description/fmt:shorten/40"
                 tal:content="cve/sequence"
                 >2002-1342</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      <tal:comments>
        <tal:comment repeat="comment_or_activity view/activity_and_comments">
          <tal:is-comment
              define="comment comment_or_activity/comment|nothing"
              condition="comment">
            <tal:comment-box replace="structure comment/@@+box" />
          </tal:is-comment>

          <tal:is-activity
              define="activity_list comment_or_activity/activity|nothing;
                      activity_date comment_or_activity/date|nothing;
                      activity_person comment_or_activity/person|nothing"
              condition="activity_list">
              <metal:comment-box
                  metal:use-macro="context/@@bugcomment-macros/activity-box" />
          </tal:is-activity>

          <tal:is-break
             define="num_hidden comment_or_activity/num_hidden|nothing"
             condition="num_hidden">
              <metal:comment-box
                  metal:use-macro="context/@@bugcomment-macros/break" />
          </tal:is-break>

        </tal:comment>
        <div style="float: right;">
          <tal:activity_log
              define="context_menu context/menu:context"
              content="structure context_menu/activitylog/render" />
        </div>
        <div class="clearfix"></div>

        <tal:comment-list-complete
            tal:condition="not:view/visible_comments_truncated_for_display">
          <tal:logged-in condition="view/user">
            <metal:comment-form
                metal:use-macro="context/@@bugcomment-macros/comment-form" />
          </tal:logged-in>

          <tal:not-logged-in condition="not: view/user">
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a
              href="+login?comments=all">log in</a>.
            </div>
          </tal:not-logged-in>
        </tal:comment-list-complete>
        <tal:comment-list-truncated
            tal:condition="view/visible_comments_truncated_for_display">
          <div class="informational message comments-hidden-message" >
            Displaying first <span
            tal:replace="view/visible_initial_comments">23</span>
            and last <span
            tal:replace="view/visible_recent_comments">32</span>
            comments.
            <tal:what-next
                define="view_all_href
                        string:${context/fmt:url}?comments=all">
              <a class="show-comments-link"
                  href="#" tal:attributes="href view_all_href">
                View all <span
                tal:replace="view/total_comments" />
                comments</a> or <a href="#" tal:attributes="href
                view_all_href">add a comment</a>.
            </tal:what-next>
          </div>
            <tal:logged-in condition="view/user">
              <div id="add-comment-form-container" class="hidden">
                <metal:comment-form
                    metal:use-macro="context/@@bugcomment-macros/comment-form" />
              </div>
            </tal:logged-in>
        </tal:comment-list-truncated>
      </tal:comments>

      </div><!-- class="top-portlet" -->
        </div><!-- id="nonportlets"-->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
  </body>
</html>
