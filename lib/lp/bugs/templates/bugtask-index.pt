<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
>
  <body>
    <metal:block fill-slot="head_epilogue">
      <script type='text/javascript' tal:content="string:var yui_base='${yui}';" />
      <script type='text/javascript' id='available-official-tags-js'
              tal:content="view/available_official_tags_js" />
      <tal:devmode condition="devmode">
       <script type="text/javascript"
                tal:define="lp_js string:${icingroot}/build"
                tal:attributes="src string:${lp_js}/bugs/subscriber.js">
       </script>
        <script type="text/javascript"
                tal:define="lp_js string:${icingroot}/build"
                tal:attributes="src string:${lp_js}/bugs/bugtask-index.js">
        </script>
        <script type="text/javascript"
                tal:define="lp_js string:${icingroot}/build"
                tal:attributes="src string:${lp_js}/bugs/bug_tags_entry.js">
        </script>
      </tal:devmode>
      <script type="text/javascript">
        YUI().use('base', 'node', 'oop', 'event', 'bugs.bugtask_index', function(Y) {
            Y.bugs.setup_bugtask_index();
        });
      </script>

      <style type="text/css"
        tal:define ="editor_skin string:${icingroot}/lazr/build/inlineedit/assets/skins/sam"
        tal:content="string:

        .edit-controls {
            background-position: right top;
            background-image: url('${editor_skin}/label-top-white.png');
            background-repeat: no-repeat;
            float:right;
            position: relative;
            top: 1px;
            height: 29px;
            width: 81px;
            line-height: 29px;
            text-align:right;
            padding-right: 8px;
        }

        .edit-controls-hover {
            background-position: right top;
            background-image: url('${editor_skin}/label-top.png');
            background-repeat: no-repeat;
        }

        #bug-description .bg-top-label {
            margin-right: -5px;
        }

        #nonportlets .report {
            margin-bottom: 29px;
        }

        #bug-description {
            font-family: inherit;
            font-size: 12px;
            margin-bottom: 25px;
            margin-top: -10px;
            width: 600px;
        }

        #bug-description h2 {
            font-family: sans-serif;
            font-size: 12px;
            font-weight: bold;
            color: #717171;
            margin-left: 1.5em;
            margin-bottom: 0;
            padding-top: 8px;
        }

        #bug-description .yui-editable_text-text {
            border-top: 1px solid #d6d6d6;
            padding:1px 20px 1px 20px;
        }

        #bug-description .yui-editable_text-text-hover {
            padding:1px 19px 0 19px;
            background-color: #fafafa;
            border: 1px solid #d6d6d6;
        }

        #bug-description .yui-ieditor-input {
            background: transparent;
            padding:11px 117px 0 18px;
            border:0;
            border: 1px solid #d6d6d6;
            border-left: 2px groove #D6D6D6;
            border-top: 2px groove #D6D6D6;
            width: 77%;
            position: relative;
            left: 5px;
        }

        #bug-description .yui-ieditor-multiline {
            background-color: #fafafa;
            border-top: 1px solid #d6d6d6;
            position: relative;
            top: -25px;
        }

        .yui-skin-sam .yui-ieditor-content {
            top: -29px;
            left: -5px;
            width:600px;
        }

        .yui-ieditor-multiline .yui-ieditor-content {
            top: -29px;
            left: -5px;
        }

        #bug-description .yui-ieditor-submit_button {
            position: relative;
            left: -4px;
        }
        #bug-description .yui-ieditor-cancel_button {
            position: relative;
            left: 16px;
            margin-right: 8px;
        }
        #bug-description .update-in-progress-message {
            margin-right: 5px;
        }

        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; max-width=60em;}
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        "/>
    </metal:block>

    <div metal:fill-slot="main" tal:define="context_menu context/menu:context">
      <div id="tags-autocomplete">
       <div id="tags-autocomplete-content"></div>
      </div>
      <p class="object timestamp">

          Bug #<tal:block content="context/bug/id"/> reported
          by <tal:reporter replace="structure context/bug/owner/fmt:link" />
          <span
              tal:attributes="title context/bug/datecreated/fmt:datetime"
              tal:content="context/bug/datecreated/fmt:displaydate" />
          <tal:activitylog
            define="link context_menu/activitylog"
            condition="link/enabled"
          >(<tal:link replace="structure link/render" />)</tal:activitylog>

      </p>
      <div class="object identifier">

          <a tal:attributes="href context/bug/fmt:url;
                             class string: ${context/image:sprite_css}">
            Bug #<span tal:content="context/bug/id"
            >12345</span><tal:nickname
                          condition="context/bug/name">
          (<tal:nicknametext replace="context/bug/name" />)</tal:nickname>:</a>

      </div>
      <tal:privacy replace="structure context/bug/@@+portlet-privacy" />
      <h1 tal:replace="structure view/bug_title_edit_widget">
        Bug title
      </h1>

      <tal:block condition="view/reportBugInContext" />

      <p class="informational message"
         tal:condition="view/notices"
         tal:repeat="notice view/notices"
         tal:content="notice">
        Reported this bug as also occurring in upstream firefox
      </p>

      <p
         id="can-expire"
         tal:condition="context/bug/can_expire"
         >
        <tal:expiration_message replace="view/expiration_message" />
        (<a href="https://help.launchpad.net/BugExpiry">find out why</a>)
      </p>

      <p id="bug-is-question" class="informational message"
         tal:condition="context/bug/getQuestionCreatedFromBug"
         tal:define="question context/bug/getQuestionCreatedFromBug">
        This bug report was converted into a question:
        question #<tal:question-id replace="question/id" />:
        <a href=""
           tal:attributes="href question/fmt:url"
           tal:content="question/title">%s</a>.
        <tal:XXX condition="nothing">
          # XXX mpt 20080716 bug=249094: This should be an alert only when
          # you have just now converted the report into a question.
        </tal:XXX>
      </p>

      <table style="width: 100%; margin-bottom: 0.33em;">
        <tr>
          <td style="text-align: left; width: 50%;">
            <span id="mark-duplicate-text"
                tal:define="link context_menu/markduplicate"
                tal:condition="python: link.enabled and not
                              context.bug.duplicateof"
            >
            <a
              tal:attributes="href link/url"
              class="menu-link-mark-dupe sprite bug-dupe">Mark as duplicate</a>
            </span>
            <tal:block
              tal:condition="context/bug/duplicates"
              tal:define="number_of_dupes context/bug/duplicates/count"
            ><span id="number_of_dupes">(This bug has
            <tal:num-dupes condition="python:number_of_dupes == 1">1
            duplicate)</tal:num-dupes>
            <tal:num-dupes condition="python:number_of_dupes > 1"
            content="string:${number_of_dupes} duplicates)"
            >2 duplicates</tal:num-dupes></span>
            </tal:block>
            <tal:block
              tal:define="duplicateof context/bug/duplicateof"
              tal:condition="duplicateof"
            >
              <span id="mark-duplicate-text">Duplicate of
              <a
                tal:condition="duplicateof/required:launchpad.View"
                tal:attributes="href duplicateof/fmt:url; title
                   duplicateof/title; style string:margin-right: 4px;
                   id string:duplicate-of;"
                tal:content="string:bug #${duplicateof/id}"
              >bug #42</a>
                <span
                  tal:condition="not:duplicateof/required:launchpad.View"
                  tal:replace="string:bug #${duplicateof/id}" />
            <a
              tal:define="link context_menu/markduplicate"
              tal:condition="python: link.enabled"
              id="change_duplicate_bug"
              title="Edit or remove linked duplicate bug"
              class="sprite edit"
              tal:attributes="href link/url">
            </a>
            </span>
            </tal:block>
          </td>

          <td style="text-align: right; width: 50%;">
            <tal:createquestion
              define="link context_menu/createquestion"
              condition="link/enabled"
              replace="structure link/render" />

            <tal:removequestion
              define="link context_menu/removequestion"
              condition="link/enabled"
              replace="structure link/render" />
          </td>
        </tr>
      </table>

      <div tal:replace="structure context/bug/@@+bugtasks-and-nominations-table" />

      <div id="maincontentsub">
        <div id="nonportlets">

      <div class="report">
        <tal:description
            define="global description context/bug/description/fmt:obfuscate-email/fmt:text-to-html" />

        <div id="bug-description"
          tal:content="structure view/bug_description"
          />

          <div id="bug-tags"
               tal:attributes="class python: ('tags-container ' +
                                              (context.bug.tags and
                                               'tags-show' or 'tags-hide'))">
            Tags:
            <span id="tag-list">
              <a tal:repeat="tag view/official_tags"
                 tal:content="tag"
                 class="official-tag"
                 tal:attributes="href string:${context/target/fmt:url}/+bugs?field.tag=${tag}">tag</a>
              <a tal:repeat="tag view/unofficial_tags"
                 tal:content="tag"
                 class="unofficial-tag"
                 tal:attributes="href string:${context/target/fmt:url}/+bugs?field.tag=${tag}">tag</a>
            </span>
            <form id="tags-form" style="display: inline">
                <input type="text" id="tag-input" style="display: none; width: 15em;" />
                <img src="/@@/spinner" id="tags-edit-spinner" style="display: none" />
                <a href="+edit" title="Edit tags" id="edit-tags-trigger" class="sprite edit"></a>
              <script type="text/javascript">
                  YUI().use('event', 'node', 'bugs.bug_tags_entry', function(Y) {
                      // XXX intellectronica 2009-04-16 bug #362309:
                      // The load event fires very late on bug pages that take a
                      // long time to render, but we prefer to use it since the
                      // domready event isn't reliable in YUI3 yet. To make sure
                      // that user doesn't click the trigger and navigates to the
                      // non-JS form, we first disable the link. This is awful and
                      // must be fixed as soon as YUI3 is fixed.
                      if (LP.client.links['me'] !== undefined) {
                          Y.get('#edit-tags-trigger').on('click', function(e) {
                              e.halt();
                          });
                      }
                      Y.on('load',
                           function(e) {
                               Y.bugs.setup_tag_entry(available_official_tags);
                           },
                           window);
                  });
              </script>

              <button class="lazr-pos lazr-btn yui-ieditor-submit_button"
                      id="edit-tags-ok" style="display: none"
                      type="button">Ok</button>
              <button class="lazr-neg lazr-btn yui-ieditor-cancel_button"
                      id="edit-tags-cancel" style="display: none"
                      type="button">Cancel</button>
           </form>
          </div>
          <div id="add-bug-tags"
               tal:attributes="class python: ('tags-container ' +
                                              (not(context.bug.tags) and
                                              'tags-show' or 'tags-hide'))">
            <a href="+edit" title="Add tags" id="add-tags-trigger" class="sprite add">
              Add tags
            </a>
          </div>

        <div class="clearfix"></div>
      </div>

      <tal:branches define="linked_branches view/linked_branches"
                    condition="linked_branches">

        <h2>Related branches</h2>

        <tal:bug-branches repeat="linked_branch linked_branches">
          <div tal:define="show_edit linked_branch/required:launchpad.Edit"
               tal:condition="linked_branch/branch/required:launchpad.View">
            <div class="bug-branch-summary">
              <tal:branch-ref replace="structure linked_branch/branch/fmt:link"/>
              (<span tal:content="linked_branch/branch/lifecycle_status/title"
              tal:attributes="class string:branchstatus${linked_branch/branch/lifecycle_status/name}"
              >Experimental</span>)
              <a title="Remove link"
                 tal:condition="show_edit"
                 tal:attributes="href string:${linked_branch/branch/fmt:url}/+bug/${linked_branch/bug/id}/+delete;">
                <img src="/@@/remove"/>
              </a>
            </div>
          </div>
        </tal:bug-branches>
      </tal:branches>

      <p>
        <tal:addbranch
            define="link context_menu/addbranch"
            condition="link/enabled"
            replace="structure link/render" />
      </p>

      <div tal:condition="context/bug/cves">
        <h2>CVE References</h2>
        <ul>
          <li class="cve" tal:repeat="cve context/bug/cves">
            <a tal:attributes="href cve/fmt:url;
                               title cve/description/fmt:shorten/40"
               tal:content="cve/sequence"
               >2002-1342</a>
          </li>
        </ul>
      </div>
      <div class="actions">
        <tal:linktocve
            define="link context_menu/linktocve"
            condition="link/enabled"
            replace="structure link/render" />
        <tal:unlinkcve
            define="link context_menu/unlinkcve"
            condition="link/enabled"
            replace="structure link/render" />
      </div>

      <tal:comments>
        <tal:comment repeat="comment_or_activity view/activity_and_comments">
          <tal:is-comment
              define="comment comment_or_activity/comment|nothing"
              condition="comment">
            <tal:comment-box condition="python: comment.can_be_shown and
                                       (view.user_is_admin or
                                       comment.visible)"
                             replace="structure comment/@@+box">
            </tal:comment-box>
          </tal:is-comment>

          <tal:is-activity
              define="activity_list comment_or_activity/activity|nothing;
                      activity_date comment_or_activity/date|nothing;
                      activity_person comment_or_activity/person|nothing"
              condition="activity_list">
              <metal:comment-box
                  metal:use-macro="context/@@bugcomment-macros/activity-box" />
          </tal:is-activity>
        </tal:comment>

        <tal:comment-list-complete
            tal:condition="not:view/visible_comments_truncated_for_display">
          <tal:logged-in condition="view/user">
            <div tal:define="comment_form nocall:context/@@+addcomment-form;
                 dummy comment_form/initialize"
                 id="add-comment-form">
              <div
                  tal:condition="context/bug/duplicateof"
                  class="warning message"
                  id="warning-comment-on-duplicate">
                  Remember, this bug report is a duplicate.
                  Comment here only if you think the duplicate status is wrong.
              </div>
              <h2>Comment</h2>
              <form action="+addcomment"
                    method="post"
                    enctype="multipart/form-data"
                    accept-charset="UTF-8">
                <tal:comment-input
                  replace="structure comment_form/widgets/comment" />
                <div class="actions"
                  tal:content="structure
                  comment_form/actions/field.actions.save/render" />
              </form>
              <tal:comment condition="nothing">
                <!-- If javascript is enabled, hide the Save Changes button.
                It will be replaced later by an "Add comment" link,
                which does commenting inline. The reason for hiding the
                button is that it's kind of ugly having it transformed
                into a link. Better to hide it and have it appear after
                a while. At some point we should be able to hook up
                inline commenting earlier than in the on-load handler,
                which would make this hack not needed. -->
              </tal:comment>
              <script type="text/javascript">
                var button = document.getElementById('field.actions.save');
                button.style.display = 'none';
              </script>
            </div>
            <tal:attachment-link
                define="add_attachment_link context_menu/addcomment"
                replace="structure add_attachment_link/render" />
          </tal:logged-in>

          <tal:not-logged-in condition="not: view/user">
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a
              href="+login?comments=all">log in</a>.
            </div>
          </tal:not-logged-in>
        </tal:comment-list-complete>
        <tal:comment-list-truncated
            tal:condition="view/visible_comments_truncated_for_display">
          <div class="informational message">
            Displaying first <span
            tal:replace="view/visible_comments_for_display/count:len" />
            comments.
            <tal:what-next
                define="view_all_href
                        string:${context/fmt:url}?comments=all">
              <a href="#" tal:attributes="href view_all_href">
                View all <span
                tal:replace="view/visible_comments/count:len" />
                comments</a> or <a href="#" tal:attributes="href
                view_all_href">add a comment</a>.
            </tal:what-next>
          </div>
        </tal:comment-list-truncated>
      </tal:comments>

      <div id="mentoring" style="margin-top: 4em">
        <tal:mentors define="mentoring_offers context/bug/mentoring_offers"
                     condition="mentoring_offers">
          <p>
            <b>Mentors:</b>
            <tal:block repeat="mentoring_offer mentoring_offers">
              <a tal:replace="structure mentoring_offer/owner/fmt:link">foobar</a>
            </tal:block>
          </p>
          <tal:block condition="not: context/bug/is_complete">
            <div tal:condition="view/userIsMentor" class="actions">
              <img class="inlineLinkIcon sprite remove" alt=""/><a href="+retractmentoring">Retract my offer of mentorship</a>
            </div>
          </tal:block>
        </tal:mentors>
        <p tal:define="link context_menu/offermentoring"
             tal:condition="link/enabled"
             tal:content="structure link/render"
        />
      </div>
      <div class="related">
        <h2>What next?</h2>
        <ul>
          <li>
            <a
                tal:attributes="href string:${context/target/fmt:url}/+filebug"
                >Report another bug</a>
            about <tal:context replace="context/target/displayname" />
          </li>
          <li>
            <a
                tal:attributes="href string:${context/target/fmt:url}/+bugs"
                >List open bugs</a>
            for <tal:context replace="context/target/displayname" />
          </li>
        </ul>
      </div>

        </div><!-- id="nonportlets"-->
      </div><!--- id="maincontentsub"-->
      <div id="portlets">
        <div tal:replace="structure context/bug/@@+portlet-duplicates" />
        <div tal:replace="structure context/bug/@@+portlet-subscribers" />
        <div tal:replace="structure context/bug/@@+portlet-questions" />
        <div tal:replace="structure context/bug/@@+portlet-specs" />
        <div tal:replace="structure context/bug/@@+portlet-attachments" />
        <div tal:replace="structure context/bug/@@+portlet-watch" />
        <div tal:replace="structure context/@@+portlet-search" />
      </div>
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
  </body>
</html>
