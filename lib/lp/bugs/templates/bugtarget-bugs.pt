<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/main_side"
  i18n:domain="malone"
>
  <metal:block fill-slot="head_epilogue">
    <script type="text/javascript" src="/+icing/FormatAndColor.js"></script>
    <script type="text/javascript" src="/+icing/PlotKit_Packed.js"></script>
  </metal:block>
  <metal:portlets fill-slot="portlets">
  </metal:portlets>
  <body>
    <tal:side metal:fill-slot="side">
      <div id="involvement" class="portlet involvement">
        <ul>
          <li style="border: none">
            <a href="+filebug" class="menu-link-filebug sprite bugs">
              Report a bug
            </a>
          </li>
          <li>
            <a tal:define="addquestion_url view/addquestion_url"
               tal:condition="addquestion_url"
               tal:attributes="href view/addquestion_url"
               class="menu-link-filebug sprite answers">
              Ask a question
            </a>
          </li>
        </ul>
      </div>
      <div class="portlet">
        <table class="bug-links">
          <tr tal:define="open_bugs_info view/open_bugs_info">
            <td class="bugs-count" tal:content="open_bugs_info/count" />
            <td class="bugs-link">
              <a tal:attributes="href open_bugs_info/url">Open bugs</a>
            </td>
          </tr>
          <tr tal:condition="view/user"
              tal:define="my_bugs_info view/my_bugs_info">
            <td class="bugs-count" tal:content="my_bugs_info/count" />
            <td class="bugs-link">
              <a tal:attributes="href my_bugs_info/url">Bugs assigned to me</a>
            </td>
          </tr>
          <tr tal:define="critical_bugs_info view/critical_bugs_info">
            <td class="bugs-count" tal:content="critical_bugs_info/count" />
            <td class="bugs-link">
              <a tal:attributes="href critical_bugs_info/url">Critical bugs</a>
            </td>
          </tr>
          <tr tal:define="fixed_elsewhere view/bugs_fixed_elsewhere_info">
            <td class="bugs-count" tal:content="fixed_elsewhere/count" />
            <td class="bugs-link">
              <a tal:attributes="href fixed_elsewhere/url">
                Bugs fixed elsewhere
              </a>
            </td>
          </tr>
          <tr tal:define="new_bugs_info view/new_bugs_info">
            <td class="bugs-count" tal:content="new_bugs_info/count" />
            <td class="bugs-link">
              <a tal:attributes="href new_bugs_info/url">New bugs</a>
            </td>
          </tr>
          <tr tal:define="cve_bugs_info view/open_cve_bugs_info">
            <td class="bugs-count" tal:content="cve_bugs_info/count" />
            <td class="bugs-link">
              <a tal:attributes="href cve_bugs_info/url">Open CVE bugs</a>
              -
              <a href="+cve">CVE reports</a>
            </td>
          </tr>
          <tr tal:define="expirable_bugs_info view/expirable_bugs_info"
              tal:condition="expirable_bugs_info">
            <td class="bugs-count" tal:content="expirable_bugs_info/count" />
            <td class="bugs-link">
              <a tal:attributes="href expirable_bugs_info/url">
                Incomplete bugs
              </a>
              (can expire)
            </td>
          </tr>
          <tr tal:define="pending_bugwatches view/pending_bugwatches_info"
              tal:condition="pending_bugwatches">
            <td class="bugs-count" tal:content="pending_bugwatches/count" />
            <td class="bugs-link">
              <a tal:attributes="href pending_bugwatches/url">
                Bugs need forwarding upstream
              </a>
            </td>
          </tr>
          <tr tal:define="subscribe_link context/menu:bugs/subscribe">
            <td class="bugs-count" style="padding-top: 1em">
              <a tal:attributes="href subscribe_link/url">
                <img tal:attributes="src subscribe_link/icon_url" />
              </a>
            </td>
            <td class="bugs-link">
              <a tal:attributes="href subscribe_link/url"
                 tal:content="subscribe_link/escapedtext" />
            </td>
          </tr>
          <tr tal:define="
                review_nominations_link context/menu:bugs/nominations|nothing"
              tal:condition="review_nominations_link">
            <td class="bugs-count" style="padding-top: 1em">
              <a tal:attributes="href review_nominations_link/url">
                <img tal:attributes="src review_nominations_link/icon_url" />
              </a>
            </td>
            <td class="bugs-link">
              <a tal:attributes="href review_nominations_link/url"
                 tal:content="review_nominations_link/escapedtext" />
            </td>
          </tr>
        </table>
      </div>
      <div tal:replace="structure context/@@+portlet-bugtags" />
      <tal:releasecriticalbugs
          tal:condition="view/shouldShowReleaseCriticalPortlet"
          tal:content="structure context/@@+portlet-bugtasklist-seriesbugs" />
      <tal:milestonecriticalbugs
          tal:condition="view/shouldShowReleaseCriticalPortlet"
          tal:content="structure context/@@+portlet-bugtasklist-milestonebugs" />
    </tal:side>
    <div metal:fill-slot="main" class="tab-bugs"
         tal:define="search_url string:+bugs;
                     advanced_search_url string:+bugs?advanced=1">

      <div class="portlet" style="float: right; border: none">
        <ul>
          <li id="bugtracker" tal:condition="not: view/uses_launchpad_bugtracker">
            <strong>Bug tracker:</strong><br />
            <span style="margin-left: 1em">
              <tal:bugtracker replace="structure view/bugtracker" />
            </span>
          </li>
          <li tal:define="bug_supervisor context/bug_supervisor">
            Bug supervisor:<br />
            <span style="margin-left: 1em">
              <tal:none condition="not:bug_supervisor">None set</tal:none>
              <a tal:condition="bug_supervisor"
                 tal:replace="structure bug_supervisor/fmt:link">Bob Johnson</a>
              <tal:edit-bug-supervisor
                  condition="context/menu:bugs/bugsupervisor|nothing">
                <a tal:define="link context/menu:bugs/bugsupervisor"
                   tal:condition="link/enabled"
                   tal:attributes="href link/url; title link/text">
                  <img tal:attributes="alt link/text" src="/@@/edit" />
                </a> 
              </tal:edit-bug-supervisor>
            </span>
          </li>
          <li tal:define="securitycontact context/security_contact">
            Security contact:<br />
            <span style="margin-left: 1em">
              <tal:none condition="not:securitycontact">None set</tal:none>
              <a tal:condition="securitycontact"
                 tal:replace="structure securitycontact/fmt:link">
                Billy Anderson
              </a>
              <tal:edit-securitycontact
                  condition="context/menu:bugs/securitycontact|nothing">
                <a tal:define="link context/menu:bugs/securitycontact"
                   tal:condition="link/enabled"
                   tal:attributes="href link/url; title link/text">
                  <img tal:attributes="alt link/text" src="/@@/edit" />
                </a>
              </tal:edit-securitycontact>
            </span>
          </li>
          <li>
          </li>
        </ul>
      </div>

      <div class="search-box">
        <metal:search
          use-macro="context/@@+bugtarget-macros-search/simple-search-form"
        />
      </div>
      <script type="text/javascript"><!--
           $('field.searchtext').focus();
      --></script>

      <h2 style="margin-top: 1em">Hot bugs</h2>

      <table class="listing" id="hot-bugs">
        <thead>
          <tr>
            <th colspan="3">Summary</th>
            <th>Status</th>
            <th>Importance</th>
            <th>Last changed</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="bugtask view/hot_bugtasks">
            <td class="icon left">
              <img alt="" src="/@@/bug" />
            </td>
            <td style="text-align: right">
              #<span tal:replace="bugtask/bug/id" />
            </td>
            <td>
              <a tal:attributes="href bugtask/fmt:url"
                 tal:content="bugtask/bug/title" />
            </td>
            <td tal:attributes="class string:status${bugtask/status/name}"
                tal:content="bugtask/status/title" />
            <td tal:attributes="
                  class string:importance${bugtask/importance/name}"
                tal:content="bugtask/importance/title" />
            <td tal:content="bugtask/bug/date_last_updated/fmt:displaydate" />
          </tr>
        </tbody>
      </table>

    </div><!-- main -->
  </body>
</html>
