<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="launchpad">
  <body>
    <div metal:fill-slot="main">
      <div metal:use-macro="context/@@launchpad_form/form">

        <metal:formbody fill-slot="widgets">
          <table class="form">

            <tal:widget define="widget nocall:view/widgets/target_branch">
              <metal:block use-macro="context/@@launchpad_form/widget_row" />
            </tal:widget>

            <tal:widget define="widget nocall:view/widgets/comment">
              <metal:block use-macro="context/@@launchpad_form/widget_row" />
            </tal:widget>

            <tal:widget define="widget nocall:view/widgets/reviewer">
              <metal:block use-macro="context/@@launchpad_form/widget_row" />
            </tal:widget>

            <tal:widget define="widget nocall:view/widgets/review_type">
              <metal:block use-macro="context/@@launchpad_form/widget_row" />
            </tal:widget>

            <td colspan="2">
              <fieldset id="mergeproposal-extra-options"
                        class="collapsible">
                <legend>Extra options</legend>
                <div class="unseen"><!-- hidden by default -->
                <table class="extra-options">

                  <tal:widget define="widget nocall:view/widgets/commit_message">
                    <metal:block use-macro="context/@@launchpad_form/widget_row" />
                  </tal:widget>

                  <tal:widget define="widget nocall:view/widgets/needs_review">
                    <metal:block use-macro="context/@@launchpad_form/widget_row" />
                  </tal:widget>

                  <tal:widget define="widget nocall:view/widgets/prerequisite_branch">
                    <metal:block use-macro="context/@@launchpad_form/widget_row" />
                  </tal:widget>



                </table>
                </div>
              </fieldset>
            </td>

          </table>
        </metal:formbody>
      </div>

      <!-- We want to disable the review_type field if no reviewer is
           specified. In such cases, the reviewer will be set by the back end
           to be the default for the target branch and the review type will be
           None.
      -->
      <tal:script>
        <script type="text/javascript" tal:content="string:
          LPS.use('node', 'event', function(Y) {
              function reviewer_changed(value) {
                reviewer = Y.Lang.trim(value);
                review_type = document.getElementById('field.review_type');
                review_type.disabled = (reviewer == '');
              };
              Y.on('blur',
                  function(e) {
                    reviewer_changed(e.target.get('value'))
                  },
                  document.getElementById('field.reviewer'));
              Y.on('load',
                  function(e) {
                    f = document.getElementById('field.reviewer')
                    reviewer_changed(f.value);
                  },
                  window);
          });"
        >
        </script>
      </tal:script>

    </div>
  </body>
</html>
