We are going to test the system by which rosetta provides alternative
translation suggestions. This will need to be updated when we change the
presentation of these items.

This test is going to work with evolution source package for Ubuntu
Hoary.  As part of this history, we have Hoary distro release with
RESTRICTED permissions and with the Polyglot translation team in charge
of its translations.

Polyglot has someone assigned for Spanish translations, and though No
Privileges is not that person, this does make it possible to enter
suggestions in Spanish.

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.ftests import login, logout
    >>> from lp.registry.interfaces.distribution import IDistributionSet
    >>> from lp.registry.interfaces.person import IPersonSet
    >>> from lp.services.worlddata.interfaces.language import ILanguageSet
    >>> from lp.translations.interfaces.potemplate import IPOTemplateSet
    >>> from lp.translations.interfaces.translator import ITranslatorSet

    >>> login('foo.bar@canonical.com')
    >>> ubuntu = getUtility(IDistributionSet).getByName('ubuntu')
    >>> spanish = getUtility(ILanguageSet)['es']
    >>> carlos = getUtility(IPersonSet).getByName('carlos')
    >>> ubuntu_spanish_reviewer = getUtility(ITranslatorSet).new(
    ...     translationgroup=ubuntu.translationgroup, language=spanish,
    ...     translator=carlos)

    >>> utility = getUtility(IPOTemplateSet)
    >>> dummy = utility.populateSuggestivePOTemplatesCache()

    >>> logout()

Let's add a new suggestion as a person without privileges.

    >>> browser.addHeader("Authorization", "Basic no-priv@canonical.com:test")
    >>> browser.open(
    ...     'http://translations.launchpad.dev/'
    ...     'ubuntu/hoary/+source/evolution/'
    ...     '+pots/evolution-2.2/es/+translate')
    >>> browser.getControl(
    ...     name='msgset_134_es_translation_0_new_checkbox').value = True
    >>> browser.getControl(
    ...     name='msgset_134_es_translation_0_new').value = 'new suggestion'
    >>> browser.getControl(name='submit_translations').click()
    >>> print browser.url
    http://.../ubuntu/.../evolution/+pots/evolution-2.2/es/+translate?start=10

    >>> browser.getLink('Previous').click()

Now, we can see the added suggestion + others from the sample data.

    >>> print find_tag_by_id(
    ...     browser.contents, "msgset_134_es_suggestion_703_0")
    <...<samp> </samp>new suggestion...

    >>> print find_tag_by_id(
    ...     browser.contents, "msgset_134_es_suggestion_703_0_origin")
    <...
    ...Suggested by...No Privileges Person...

These are old suggestions:

    >>> print find_tag_by_id(
    ...     browser.contents, "msgset_134_es_suggestion_698_0")
    <...<samp> </samp>Srprise! (non-editor)...

    >>> print find_tag_by_id(
    ...     browser.contents, "msgset_134_es_suggestion_698_0_origin")
    <...
    ...Suggested by...Valentina Commissari...2005-06-06...

    >>> print find_tag_by_id(
    ...     browser.contents, "msgset_134_es_suggestion_696_0")
    <...<samp> </samp>bang bang in evo hoary...

    >>> print find_tag_by_id(
    ...     browser.contents, "msgset_134_es_suggestion_696_0_origin")
    <...
    ...Suggested in...evolution-2.2 in Evolution trunk...
    ...Mark Shuttleworth</a>...2005-06-06...

And there's also a separate translation coming from upstream:

    >>> print find_tag_by_id(browser.contents, "msgset_134_packaged")
    <...<samp> </samp>tarjetas...

    >>> print find_tag_by_id(browser.contents, "msgset_134_packaged_origin")
    <...
    ...Suggested by...Carlos Perelló Marín...2005-05-06...

