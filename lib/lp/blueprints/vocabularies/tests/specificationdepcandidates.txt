SpecificationDepCandidatesVocabulary
====================================

All blueprints that can be added as a dependency of the context
blueprint.

    >>> from zope.schema.vocabulary import getVocabularyRegistry
    >>> vocabulary_registry = getVocabularyRegistry()

First, we set up a product with three blueprints.

    >>> specced_product = factory.makeProduct()
    >>> spec_a = factory.makeSpecification(
    ...     name='spec-a', summary='The first spec',
    ...     product=specced_product)
    >>> spec_b = factory.makeSpecification(
    ...     name='spec-b', summary='The second spec',
    ...     product=specced_product)
    >>> spec_c = factory.makeSpecification(
    ...     name='spec-c', summary='The third spec',
    ...     product=specced_product)
    >>> sorted([spec.name for spec in specced_product.specifications()])
    [u'spec-a', u'spec-b', u'spec-c']


Iterating over the vocabulary gives all blueprints for specced_product
except for spec_a itself.

    >>> vocab = vocabulary_registry.get(
    ...     spec_a, "SpecificationDepCandidates")
    >>> sorted([term.value.name for term in vocab])
    [u'spec-b', u'spec-c']

Blueprints for other targets are considered to be 'in' the vocabulary
though.

    >>> unrelated_spec = factory.makeSpecification(
    ...     product=factory.makeProduct())
    >>> vocab = vocabulary_registry.get(
    ...     spec_a, "SpecificationDepCandidates")
    >>> unrelated_spec in vocab
    True

We mark spec_b as a dependency of spec_a and spec_c as a dependency of
spec_b.

    >>> spec_a.createDependency(spec_b)
    <SpecificationDependency at ...>
    >>> [spec.name for spec in spec_a.dependencies]
    [u'spec-b']

    >>> spec_b.createDependency(spec_c)
    <SpecificationDependency at ...>
    >>> [spec.name for spec in spec_b.dependencies]
    [u'spec-c']

No circular dependencies - the vocabulary excludes specifications that
are a dependency of the context spec.

    >>> spec_a in set(spec_b.all_blocked)
    True
    >>> spec_b in set(spec_c.all_blocked)
    True
    >>> vocab = vocabulary_registry.get(
    ...     spec_c, "SpecificationDepCandidates")
    >>> spec_a in [term.value for term in vocab]
    False

This vocabulary provides the IHugeVocabulary interface.

    >>> from canonical.launchpad.webapp.testing import verifyObject
    >>> from canonical.launchpad.webapp.vocabulary import IHugeVocabulary
    >>> verifyObject(IHugeVocabulary, vocab)
    True

The search() method returns specifications within the vocabulary that
matches the search string. The string is matched against the name, or
fallbacks to a full text search.

    >>> from zope.security.proxy import removeSecurityProxy
    >>> naked_vocab = removeSecurityProxy(
    ...     vocabulary_registry.get(
    ...         spec_a, "SpecificationDepCandidates"))
    >>> list(naked_vocab.search('spec-b')) == [spec_b]
    True
    >>> list(naked_vocab.search('third')) == [spec_c]
    True

The search method uses the SQL `LIKE` operator, with the values quoted
appropriately. Queries conataining regual expression operators, for
example, will simply look for the respective characters within the
vocabulary's item (this used to be the cause of an OOPS, see
https://bugs.launchpad.net/blueprint/+bug/139385 for more
details).

    >>> list(naked_vocab.search('*'))
    []
